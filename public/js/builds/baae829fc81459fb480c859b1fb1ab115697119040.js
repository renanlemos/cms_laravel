$app.service('MenuService',function($resource,$http){this.menu=function(){return itens=[{display:"HOME",href:"/admin",title:"Home",apelido:"home",itemParent:false},{display:"SITE",href:"#",title:"Site",apelido:"site",itemParent:true,itens:[{display:"Configuração Global",href:"/admin/site/configuracao-global",title:"Configuração Global",apelido:"configuracao-global"}]},{display:"USUÁRIOS",href:"/admin/usuarios",title:"Usuários",apelido:"usuarios",itemParent:false},{display:"CONTEÚDO",href:"#",title:"Conteúdo",apelido:"conteudo",itemParent:true,itens:[{display:"Artigos",href:"/admin/conteudo/artigos",title:"Artigos",apelido:"artigos",itemParent:false},{display:"Categorias",href:"/admin/conteudo/artigo-categorias",title:"Categorias",apelido:"artigo-categorias",itemParent:false},{display:"Mídias",href:"/admin/conteudo/midias",title:"Mídias",apelido:"midias",itemParent:false}]},{display:"COMPONENTES",title:"Componentes",href:"#",apelido:"componentes",itemParent:true,itens:[{display:"Banner Slider",href:"/admin/componentes/componente-banner-slider",title:"Banner Slider",apelido:"componente-banner-slider",itemParent:false},{display:"Contato",href:"/admin/componentes/componente-contato",title:"Contato",apelido:"componente-contato",itemParent:false}]},{display:"MÓDULOS",title:"Módulos",href:"#",apelido:"modulos",itemParent:true,itens:[{display:"Posição",href:"/admin/modulos/modulo-posicao",title:"Módulo Posição",apelido:"modulo-posicao",itemParent:false},{display:"Html",href:"/admin/modulos/modulo-html",title:"Html",apelido:"modulo-html",itemParent:false},{display:"Banner Slider",href:"/admin/modulos/modulo-banner-slider",title:"Banner Slider",apelido:"modulo-banner-slider",itemParent:false},{display:"Contato",href:"/admin/modulos/modulo-contato",title:"Contato",apelido:"modulo-contato",itemParent:false}]},{display:"LOGS",title:"Logs",href:"/admin/logs",apelido:"logs",itemParent:false}];}
this.getTarifarios=function(){return $rootScope.cliente_tarifarios;}
this.getMenu=function(){return this.menu();}
this.updateClienteTarifarios=function(){var c=$resource('/tarifarios/tarifarios-cliente-logado');c.query(function(response){$cookies.cliente_tarifarios=angular.toJson(response);},function(response){alert("Erro ao carregar tarifários.");});}});$app.service('ListDataService',function(){this.moduloPosicaoGrid=function(){var data=new kendo.data.DataSource({transport:{read:{url:"/admin/modulo-posicaos/combo",async:false}},schema:{parse:function(data){var dados=[];for(var i=0;i<data.length;i++){var item={value:data[i].id,text:data[i].descricao};dados.push(item);}
return dados;}}});data.read();return data.data().toJSON();}
this.artigoCategoriasGrid=function(){var data=new kendo.data.DataSource({transport:{read:{url:"/admin/conteudo/artigo-categorias/combo",async:false}},schema:{parse:function(data){var dados=[];for(var i=0;i<data.length;i++){var item={value:data[i].id,text:data[i].descricao};dados.push(item);}
return dados;}}});data.read();return data.data().toJSON();}});$app.service('FileService',function($rootScope,$http,CSRF_TOKEN){var files=[];$rootScope.filesService=[];$rootScope.fileRespService="";$rootScope.fileImagesService=[];var path="";this.setPath=function(path){this.path=path;}
this.getPath=function(path){return this.path;}
this.getFiles=function(){return files;}
this.setFile=function(file){valid(file);if($rootScope.fileRespService.length==0){$rootScope.filesService.push(file);$rootScope.$apply();}}
this.uploadFiles=function(options){var uploaded=false;if($rootScope.filesService.length>0){$rootScope.fileRespService="- Enviando arquivos...";var fd=new FormData();angular.forEach($rootScope.filesService,function(value,key){fd.append('file-'+key,$rootScope.filesService[key]);})
fd.append("qnt_files",$rootScope.filesService.length);fd.append("path",this.path);fd.append("_token",CSRF_TOKEN);$http.post("/admin/files/uploads",fd,{withCredentials:true,headers:{'Content-Type':undefined},transformRequest:angular.identity}).success(function(response){$rootScope.fileRespService="";angular.forEach(response,function(v,k){$rootScope.fileRespService+=v.file+": "+v.data+"<br>";if(v.status==1){uploaded=true;$rootScope.filesService.splice($rootScope.filesService[v.index],1);}});if(uploaded==true&&options.refreshCombo==true){var combo=$("#comboImagem").data("kendoComboBox");combo.dataSource.read();$rootScope.fileImagesService=combo.dataSource.data();}}).error(function(){$rootScope.fileRespService="- Ocorreu um erro no Servidor";});}else{$rootScope.fileRespService="- Nenhum arquivo selecionado";}}
this.deleteFile=function(index){$rootScope.filesService.splice($rootScope.filesService[index],1);$rootScope.$apply();}
valid=function(file){$rootScope.fileRespService="";if(file.type!='image/png'&&file.type!='image/jpeg'){$rootScope.fileRespService="- A imagem deve ser PNG ou JPG."}else if(contemFile(file)){$rootScope.fileRespService="- Esse nome de arquivo já foi selecionado."}
$rootScope.$apply();}
contemFile=function(file){var search=false;if(search==false&&$rootScope.filesService.length>0){angular.forEach($rootScope.filesService,function(v,k){if(file.name==v.name){alert('teste');search=true;}});}
return search;}});$app.service("AuthService",function($rootScope,$resource,$location,$cookies,$timeout,$route){var permissoes="";this.verificaLogin=function(){var auth=$resource("/admin/auth/verify");auth.get(function(response){if(response.status==false){$rootScope.isLogado=false;$location.path("admin/login");}else{$rootScope.permissoes=angular.fromJson(response.data.permissoes);permissoes=angular.fromJson(response.data.permissoes);$rootScope.isLogado=true;$rootScope.nome_admin_logado=response.data.nome;$rootScope.nome_usuario_admin_logado=response.data.nome_usuario;$rootScope.id_usuario_admin_logado=response.data.id;$rootScope.email_admin_logado=response.data.email;}},function(response){});}
this.getPermissoes=function(){return $rootScope.permissoes;}
this.setPermissoes=function(data){$rootScope.permissoes=JSON.parse(data);}
this.getPermissao=function(apelido){var permissao=null;var search=false;if(search==false){angular.forEach(permissoes,function(value,key){if(apelido==value.nome){permissao=value;search=true;}});}
return permissao;}
this.checkView=function(apelido){var permissao=this.getPermissao(apelido);if(permissao==null){$location.path("admin/erro/403");return false;}
if(permissao.view==false){$location.path("admin/erro/403");}}
this.checkCreate=function(apelido){var permissao=this.getPermissao(apelido);if(permissao==null){alert("Sem permissão para criar.");return false;}
if(permissao.create==false){alert("Sem permissão para criar.");}
return permissao.create;}
this.checkUpdate=function(apelido){var permissao=this.getPermissao(apelido);if(permissao==null){alert("Sem permissão para alterar.");return false;}
if(permissao.update==false){alert("Sem permissão para alterar.");}
return permissao.update;}
this.checkDelete=function(apelido){var permissao=this.getPermissao(apelido);if(permissao==null){alert("Sem permissão para deletar.");return false;}
if(permissao.delete==false){alert("Sem permissão para deletar.");}
return permissao.delete;}
this.setLogin=function(user){$cookies.id_admin_logado=user[0].id;$cookies.nome_admin_logado=user[0].nome;$cookies.nome_usuario_admin_logado=user[0].nome_usuario;$cookies.email_admin_logado=user[0].email;}});