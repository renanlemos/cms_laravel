$app.controller('ModuloPosicaoController',function($scope,$resource,AuthService,CSRF_TOKEN){$scope.title="Módulo Posição";$scope.window={new:function(){$scope.dataItem={descricao:""};$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Adicionar Módulo"});$scope.modal.open().center();},edit:function(dataItem){$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Módulo: "+dataItem.id});$scope.modal.open().center();$scope.dataItem=dataItem;},close:function(){$scope.modal.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("modulo-posicao",true)&&AuthService.checkCreate("modulos",true)){var request=$resource("/admin/modulo-posicaos",{_token:CSRF_TOKEN});$scope.loaderForm=true;request.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={descricao:""};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("modulo-posicao",true)&&AuthService.checkUpdate("modulos",true)){var request=$resource("/admin/modulo-posicaos",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;request.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("modulo-posicao",true)&&AuthService.checkDelete("modulos",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var request=$resource("/admin/modulo-posicaos");$scope.loaderForm=true;request.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/modulo-posicaos/grid'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:"data",total:"total",model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"descricao",title:"Descrição",type:"string"},{command:[{template:"<button class=\'k-button\' ng-disabled='access_update == false' ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\' ng-disabled='access_destroy == false' ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}]}]}}
optionsModal=function(){$scope.conf_modal={title:'Módulo Html',width:'400',height:'150',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}}
init=function(){AuthService.checkView("modulos");AuthService.checkView("modulo-posicao");optionsModal();optionsGrid();}
init();});$app.controller('ModuloMenuController',function($timeout,$scope,$rootScope,$resource,AuthService,ListDataService,CSRF_TOKEN){$scope.title="Módulo Menu";$scope.editorDescricao=false;var comboPosicaoGrid="";$scope.window={new:function(){$scope.dataItem={titulo:"",apelido:"",tipo:"menu",modulo_posicao_id:"",publicado:true,mostrar_titulo:0,tag_titulo:"h1",conteudo:"",parametros:{menu_id:"",menu_template:"padrao",class:"",id:""},ordem:""};$scope.mostrar_titulo="";$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Adicionar Módulo"});$scope.modal.open().center();refreshComboPosicao();refreshComboMenu();},edit:function(dataItem){$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Módulo: "+dataItem.id});$scope.modal.open().center();$scope.dataItem=dataItem;$scope.dataItem.parametros=angular.fromJson(dataItem.parametros);if(dataItem.mostrar_titulo==true){$scope.dataItem.mostrar_titulo=1;}
if(dataItem.mostrar_titulo==false){$scope.dataItem.mostrar_titulo=0;}
refreshComboPosicao();refreshComboMenu();},ordem:function(dataItem){$scope.dataItem=dataItem;$scope.modal_ordem.open().center();},close:function(){$scope.modal.close();},close_ordem:function(){$scope.modal_ordem.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("modulo-menu",true)&&AuthService.checkCreate("modulos",true)){var request=$resource("/admin/modulos",{_token:CSRF_TOKEN});$scope.loaderForm=true;''
request.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={titulo:"",apelido:"",tipo:"menu",modulo_posicao_id:"",publicado:true,mostrar_titulo:0,tag_titulo:"h1",conteudo:"",parametros:{menu_id:"",menu_template:"padrao",class:"",id:""},ordem:""};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("modulo-menu",true)&&AuthService.checkUpdate("modulos",true)){var request=$resource("/admin/modulos",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;request.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("modulo-menu",true)&&AuthService.checkDelete("modulos",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var request=$resource("/admin/modulos");$scope.loaderForm=true;request.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/modulos/grid?tipo=menu'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:function(response){comboPosicaoGrid=response.posicaos;return response.data;},total:function(response){return response.total;},model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"titulo",title:"Titulo",type:"string"},{field:"apelido",title:"Apelido",type:"string"},{field:"ordem",title:"Ordem",type:"number",width:"100px"},{field:"modulo_posicao_id",template:function(dataItem){return ListDataService.getForeignText(comboPosicaoGrid,dataItem.modulo_posicao_id);},title:"Posição",type:"number",filterable:{ui:posicaoFilter}},{command:[{template:"<button class=\'k-button\'  ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\'  ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='window.ordem(dataItem)'>Ordem</button>"}]}]}
function posicaoFilter(element){element.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:{data:angular.fromJson(comboPosicaoGrid)},optionLabel:"--Select Value--"});}}
optionsModal=function(){$scope.conf_modal={title:'Módulo Html',width:'1000',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}
$scope.conf_modal_ordem={title:'Ordenação',width:'500',height:'500',actions:["Minimize","Maximize"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}},open:function(){$scope.openOrdem=true;},close:function(){$scope.openOrdem=false;}}}
optionsCombo=function(){$scope.comboPosicao={filter:'contains',dataTextField:"descricao",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/modulo-posicaos/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboMenu={filter:'contains',dataTextField:"titulo",dataValueField:"id",autoBind:0,dataSource:{transport:{read:{url:"/admin/menus/combo",async:true}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboMostrarTitulo={filter:'contains',dataTextField:"text",dataValueField:"value",autoBind:false,dataSource:{data:[{text:"Não",value:false},{text:"Sim",value:true}]}}
$scope.comboTagTitulo={filter:'contains',dataTextField:"v",dataValueField:"v",autoBind:false,dataSource:{data:[{v:"h1"},{v:"h2"},{v:"h3"},{v:"h4"},{v:"h5"},{v:"h6"}]}}
$scope.comboMenuTemplate={filter:'contains',dataTextField:"text",dataValueField:"value",autoBind:false,dataSource:{data:[{text:"Padrão",value:'padrao'}]}}}
$scope.updateOrdemModulo=function(){var request=$resource('/admin/modulos/updateModulosOrdem',{_token:CSRF_TOKEN},{update:{method:"PUT"}});if($rootScope.itensOrdemModuloSortable==""){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");}else{$(".status-ordem-modulo").removeClass('btn-success bt-danger').addClass('btn-primary').html("<span>Alterando Ordem</span>");request.update({itens:$rootScope.itensOrdemModuloSortable},function(response){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");$scope.grid.dataSource.read();},function(response){alert('error');})}}
refreshComboPosicao=function(){var comboPosicao=$("#comboPosicao").data("kendoComboBox");comboPosicao.dataSource.read();}
refreshComboMenu=function(){var comboPosicao=$("#comboMenu").data("kendoComboBox");comboPosicao.dataSource.read();}
$scope.loaderEditorDescricao=function(){$timeout(function(){$scope.editorDescricao=true;},1000);}
init=function(){AuthService.checkView("modulos");AuthService.checkView("modulo-menu");$scope.openOrdem=false;$rootScope.itensOrdemModuloSortable="";optionsCombo();optionsModal();optionsGrid();}
init();});$app.controller('ModuloHtmlController',function($timeout,$scope,$rootScope,$resource,AuthService,ListDataService,CSRF_TOKEN){$scope.title="Módulo Html";$scope.editorDescricao=false;var comboPosicaoGrid="";$scope.window={new:function(){$scope.dataItem={titulo:"",apelido:"",tipo:"html",modulo_posicao_id:"",publicado:true,mostrar_titulo:0,tag_titulo:"h1",conteudo:"",parametros:{class:"",id:""},ordem:""};$scope.mostrar_titulo="";$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Adicionar Módulo"});$scope.modal.open().center();},edit:function(dataItem){$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Módulo: "+dataItem.id});$scope.modal.open().center();$scope.dataItem=dataItem;$scope.dataItem.parametros=angular.fromJson(dataItem.parametros);if(dataItem.mostrar_titulo==true){$scope.dataItem.mostrar_titulo=1;}
if(dataItem.mostrar_titulo==false){$scope.dataItem.mostrar_titulo=0;}},ordem:function(dataItem){$scope.dataItem=dataItem;$scope.modal_ordem.open().center();},close:function(){$scope.modal.close();},close_ordem:function(){$scope.modal_ordem.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("modulo-html",true)&&AuthService.checkCreate("modulos",true)){var request=$resource("/admin/modulos",{_token:CSRF_TOKEN});$scope.loaderForm=true;''
request.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={titulo:"",apelido:"",tipo:"html",modulo_posicao_id:"",publicado:true,mostrar_titulo:0,tag_titulo:"h1",conteudo:"",parametros:{class:"",id:""},ordem:""};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("modulo-html",true)&&AuthService.checkUpdate("modulos",true)){var request=$resource("/admin/modulos",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;request.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("modulo-html",true)&&AuthService.checkDelete("modulos",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var request=$resource("/admin/modulos");$scope.loaderForm=true;request.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/modulos/grid?tipo=html'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:function(response){comboPosicaoGrid=response.posicaos;return response.data;},total:function(response){return response.total;},model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"titulo",title:"Titulo",type:"string"},{field:"apelido",title:"Apelido",type:"string"},{field:"ordem",title:"Ordem",type:"number",width:"100px"},{field:"modulo_posicao_id",template:function(dataItem){return ListDataService.getForeignText(comboPosicaoGrid,dataItem.modulo_posicao_id);},title:"Posição",type:"number",filterable:{ui:posicaoFilter}},{command:[{template:"<button class=\'k-button\'  ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\'  ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='window.ordem(dataItem)'>Ordem</button>"}]}]}
function posicaoFilter(element){element.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:{data:angular.fromJson(comboPosicaoGrid)},optionLabel:"--Select Value--"});}}
optionsModal=function(){$scope.conf_modal={title:'Módulo Html',width:'1000',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}
$scope.conf_modal_ordem={title:'Ordenação',width:'500',height:'500',actions:["Minimize","Maximize"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}},open:function(){$scope.openOrdem=true;},close:function(){$scope.openOrdem=false;}}}
optionsCombo=function(){$scope.comboPosicao={filter:'contains',dataTextField:"descricao",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/modulo-posicaos/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboMostrarTitulo={filter:'contains',dataTextField:"text",dataValueField:"value",autoBind:false,dataSource:{data:[{text:"Não",value:false},{text:"Sim",value:true}]}}
$scope.comboTagTitulo={filter:'contains',dataTextField:"v",dataValueField:"v",autoBind:false,dataSource:{data:[{v:"h1"},{v:"h2"},{v:"h3"},{v:"h4"},{v:"h5"},{v:"h6"}]}}}
$scope.updateOrdemModulo=function(){var request=$resource('/admin/modulos/updateModulosOrdem',{_token:CSRF_TOKEN},{update:{method:"PUT"}});if($rootScope.itensOrdemModuloSortable==""){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");}else{$(".status-ordem-modulo").removeClass('btn-success bt-danger').addClass('btn-primary').html("<span>Alterando Ordem</span>");request.update({itens:$rootScope.itensOrdemModuloSortable},function(response){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");$scope.grid.dataSource.read();},function(response){alert('error');})}}
$scope.refreshComboPosicao=function(){var comboPosicao=$("#comboPosicao").data("kendoComboBox");comboPosicao.dataSource.read();}
$scope.loaderEditorDescricao=function(){$timeout(function(){$scope.editorDescricao=true;},1000);}
init=function(){AuthService.checkView("modulos");AuthService.checkView("modulo-html");$scope.openOrdem=false;$rootScope.itensOrdemModuloSortable="";optionsCombo();optionsModal();optionsGrid();}
init();});$app.controller('ModuloContatoController',function($timeout,$scope,$rootScope,$resource,AuthService,ListDataService,CSRF_TOKEN){$scope.title="Módulo Contato";$scope.editorDescricao=false;var comboPosicaoGrid="";$scope.window={new:function(){$scope.dataItem={titulo:"",apelido:"",tipo:"contato",modulo_posicao_id:"",publicado:true,mostrar_titulo:0,tag_titulo:"h1",conteudo:"",parametros:{contato_id:"",class:"",id:""},ordem:""};$scope.mostrar_titulo="";$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Adicionar Módulo"});$scope.modal.open().center();},edit:function(dataItem){$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Módulo: "+dataItem.id});$scope.modal.open().center();$scope.dataItem=dataItem;$scope.dataItem.parametros=angular.fromJson(dataItem.parametros);if(dataItem.mostrar_titulo==true){$scope.dataItem.mostrar_titulo=1;}
if(dataItem.mostrar_titulo==false){$scope.dataItem.mostrar_titulo=0;}},ordem:function(dataItem){$scope.dataItem=dataItem;$scope.modal_ordem.open().center();},close:function(){$scope.modal.close();},close_ordem:function(){$scope.modal_ordem.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("modulo-contato",true)&&AuthService.checkCreate("modulos",true)){var request=$resource("/admin/modulos",{_token:CSRF_TOKEN});$scope.loaderForm=true;''
request.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={titulo:"",apelido:"",tipo:"contato",modulo_posicao_id:"",publicado:true,mostrar_titulo:0,tag_titulo:"h1",conteudo:"",parametros:{contato_id:"",class:"",id:""},ordem:""};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("modulo-contato",true)&&AuthService.checkUpdate("modulos",true)){var request=$resource("/admin/modulos",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;request.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("modulo-contato",true)&&AuthService.checkDelete("modulos",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var request=$resource("/admin/modulos");$scope.loaderForm=true;request.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/modulos/grid?tipo=contato'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:function(response){comboPosicaoGrid=response.posicaos;return response.data;},total:function(response){return response.total;},model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"titulo",title:"Titulo",type:"string"},{field:"apelido",title:"Apelido",type:"string"},{field:"ordem",title:"Ordem",type:"number",width:"100px"},{field:"modulo_posicao_id",template:function(dataItem){return ListDataService.getForeignText(comboPosicaoGrid,dataItem.modulo_posicao_id);},title:"Posição",type:"number",filterable:{ui:posicaoFilter}},{command:[{template:"<button class=\'k-button\'  ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\'  ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='window.ordem(dataItem)'>Ordem</button>"}]}]}
function posicaoFilter(element){element.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:{data:angular.fromJson(comboPosicaoGrid)},optionLabel:"--Select Value--"});}}
optionsModal=function(){$scope.conf_modal={title:'Módulo Html',width:'1000',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}
$scope.conf_modal_ordem={title:'Ordenação',width:'500',height:'500',actions:["Minimize","Maximize"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}},open:function(){$scope.openOrdem=true;},close:function(){$scope.openOrdem=false;}}}
optionsCombo=function(){$scope.comboPosicao={filter:'contains',dataTextField:"descricao",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/modulo-posicaos/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboContato={filter:'contains',dataTextField:"titulo",dataValueField:"id",autoBind:0,dataSource:{transport:{read:{url:"/admin/componentes/contatos/combo",async:true}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboMostrarTitulo={filter:'contains',dataTextField:"text",dataValueField:"value",autoBind:false,dataSource:{data:[{text:"Não",value:false},{text:"Sim",value:true}]}}
$scope.comboTagTitulo={filter:'contains',dataTextField:"v",dataValueField:"v",autoBind:false,dataSource:{data:[{v:"h1"},{v:"h2"},{v:"h3"},{v:"h4"},{v:"h5"},{v:"h6"}]}}}
$scope.updateOrdemModulo=function(){var request=$resource('/admin/modulos/updateModulosOrdem',{_token:CSRF_TOKEN},{update:{method:"PUT"}});if($rootScope.itensOrdemModuloSortable==""){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");}else{$(".status-ordem-modulo").removeClass('btn-success bt-danger').addClass('btn-primary').html("<span>Alterando Ordem</span>");request.update({itens:$rootScope.itensOrdemModuloSortable},function(response){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");$scope.grid.dataSource.read();},function(response){alert('error');})}}
$scope.refreshComboPosicao=function(){var comboPosicao=$("#comboPosicao").data("kendoComboBox");comboPosicao.dataSource.read();}
$scope.loaderEditorDescricao=function(){$timeout(function(){$scope.editorDescricao=true;},1000);}
init=function(){AuthService.checkView("modulos");AuthService.checkView("modulo-contato");$scope.openOrdem=false;$rootScope.itensOrdemModuloSortable="";optionsCombo();optionsModal();optionsGrid();}
init();});$app.controller('ModuloBannerSliderController',function($timeout,$scope,$rootScope,$resource,AuthService,ListDataService,CSRF_TOKEN){$scope.title="Módulo Banner Slider";$scope.editorDescricao=false;var comboPosicaoGrid="";$scope.window={new:function(){var comboBanner=$('#comboBanner').data('kendoComboBox');$scope.dataItem={titulo:"",apelido:"",tipo:"banner-slider",modulo_posicao_id:"",publicado:true,mostrar_titulo:0,tag_titulo:"h1",conteudo:"",parametros:{banner_id:"",efeito:"fade",timeout:4000,speed:1000,pause:0,prev:0,next:0,paginacao:0,class:"",id:""},ordem:""};$scope.mostrar_titulo="";$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Adicionar Módulo"});$scope.modal.open().center();},edit:function(dataItem){$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Módulo: "+dataItem.id});$scope.modal.open().center();$scope.dataItem=dataItem;$scope.dataItem.parametros=angular.fromJson(dataItem.parametros);if(dataItem.mostrar_titulo==true){$scope.dataItem.mostrar_titulo=1;}
if(dataItem.mostrar_titulo==false){$scope.dataItem.mostrar_titulo=0;}},ordem:function(dataItem){$scope.dataItem=dataItem;$scope.modal_ordem.open().center();},close:function(){$scope.modal.close();},close_ordem:function(){$scope.modal_ordem.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("modulo-banner-slider",true)&&AuthService.checkCreate("modulos",true)){var request=$resource("/admin/modulos",{_token:CSRF_TOKEN});$scope.loaderForm=true;''
request.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={titulo:"",apelido:"",tipo:"banner-slider",modulo_posicao_id:"",publicado:true,mostrar_titulo:0,tag_titulo:"h1",conteudo:"",parametros:{banner_id:"",efeito:"fade",timeout:4000,speed:1000,pause:0,prev:0,next:0,paginacao:0,class:"",id:""},ordem:""};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("modulo-banner-slider",true)&&AuthService.checkUpdate("modulos",true)){var request=$resource("/admin/modulos",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;request.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("modulo-banner-slider",true)&&AuthService.checkDelete("modulos",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var request=$resource("/admin/modulos");$scope.loaderForm=true;request.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/modulos/grid?tipo=banner-slider'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:function(response){comboPosicaoGrid=response.posicaos;return response.data;},total:function(response){return response.total;},model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"titulo",title:"Titulo",type:"string"},{field:"apelido",title:"Apelido",type:"string"},{field:"ordem",title:"Ordem",type:"number",width:"100px"},{field:"modulo_posicao_id",template:function(dataItem){return ListDataService.getForeignText(comboPosicaoGrid,dataItem.modulo_posicao_id);},title:"Posição",type:"number",filterable:{ui:posicaoFilter}},{command:[{template:"<button class=\'k-button\'  ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\'  ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='window.ordem(dataItem)'>Ordem</button>"}]}]}
function posicaoFilter(element){element.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:{data:angular.fromJson(comboPosicaoGrid)},optionLabel:"--Select Value--"});}}
optionsModal=function(){$scope.conf_modal={title:'Módulo Html',width:'1000',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}
$scope.conf_modal_ordem={title:'Ordenação',width:'500',height:'500',actions:["Minimize","Maximize"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}},open:function(){$scope.openOrdem=true;},close:function(){$scope.openOrdem=false;}}}
optionsCombo=function(){$scope.comboPosicao={filter:'contains',dataTextField:"descricao",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/modulo-posicaos/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboMostrarTitulo={filter:'contains',dataTextField:"text",dataValueField:"value",autoBind:false,dataSource:{data:[{text:"Não",value:false},{text:"Sim",value:true}]}}
$scope.comboTagTitulo={filter:'contains',dataTextField:"v",dataValueField:"v",autoBind:false,dataSource:{data:[{v:"h1"},{v:"h2"},{v:"h3"},{v:"h4"},{v:"h5"},{v:"h6"}]}}
$scope.comboBanner={filter:'contains',dataTextField:"descricao",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/componentes/banner-sliders/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.optionsEfeito={filter:'contains',dataTextField:"v",dataValueField:"v",autoBind:false,dataSource:{data:[{v:"blindX"},{v:"blindY"},{v:"blindZ"},{v:"cover"},{v:"curtainX"},{v:"curtainY"},{v:"fade"},{v:"fadeZoom"},{v:"growX"},{v:"growY"},{v:"none"},{v:"scrollUp"},{v:"scrollDown"},{v:"scrollLeft"},{v:"scrollRight"},{v:"scrollHorz"},{v:"scrollVert"},{v:"shuffle"},{v:"slideX"},{v:"slideY"},{v:"toss"},{v:"turnUp"},{v:"turnDown"},{v:"turnLeft"},{v:"turnRight"},{v:"uncover"},{v:"wipe"},{v:"zoom"}]}}
$scope.optionsTimeout={filter:'contains',dataTextField:"t",dataValueField:"v",autoBind:false,dataSource:{data:[{v:1000,t:"1 Segundo"},{v:2000,t:"2 Segundos"},{v:3000,t:"3 Segundos"},{v:4000,t:"4 Segundos"},{v:5000,t:"5 Segundos"},{v:6000,t:"6 Segundos"},{v:7000,t:"7 Segundos"},{v:8000,t:"8 Segundos"},{v:9000,t:"9 Segundos"},{v:10000,t:"10 Segundos"}]}}
$scope.optionsSpeed={filter:'contains',dataTextField:"t",dataValueField:"v",autoBind:false,dataSource:{data:[{v:1000,t:"1 Segundo"},{v:2000,t:"2 Segundos"},{v:3000,t:"3 Segundos"},{v:4000,t:"4 Segundos"},{v:5000,t:"5 Segundos"},{v:6000,t:"6 Segundos"},{v:7000,t:"7 Segundos"},{v:8000,t:"8 Segundos"},{v:9000,t:"9 Segundos"},{v:10000,t:"10 Segundos"}]}}
$scope.optionsPause={filter:'contains',dataTextField:"t",dataValueField:"v",autoBind:false,dataSource:{data:[{v:1,t:"Sim"},{v:0,t:"Não"}]}}
$scope.optionsPrev={filter:'contains',dataTextField:"t",dataValueField:"v",autoBind:false,dataSource:{data:[{v:1,t:"Sim"},{v:0,t:"Não"}]}}
$scope.optionsNext={filter:'contains',dataTextField:"t",dataValueField:"v",autoBind:false,dataSource:{data:[{v:1,t:"Sim"},{v:0,t:"Não"}]}}
$scope.optionsPaginacao={filter:'contains',dataTextField:"t",dataValueField:"v",autoBind:false,dataSource:{data:[{v:1,t:"Sim"},{v:0,t:"Não"}]}}}
$scope.updateOrdemModulo=function(){var request=$resource('/admin/modulos/updateModulosOrdem',{_token:CSRF_TOKEN},{update:{method:"PUT"}});if($rootScope.itensOrdemModuloSortable==""){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");}else{$(".status-ordem-modulo").removeClass('btn-success bt-danger').addClass('btn-primary').html("<span>Alterando Ordem</span>");request.update({itens:$rootScope.itensOrdemModuloSortable},function(response){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");$scope.grid.dataSource.read();},function(response){alert('error');})}}
$scope.refreshComboPosicao=function(){var comboPosicao=$("#comboPosicao").data("kendoComboBox");comboPosicao.dataSource.read();}
$scope.loaderEditorDescricao=function(){$timeout(function(){$scope.editorDescricao=true;},1000);}
init=function(){AuthService.checkView("modulos");AuthService.checkView("modulo-banner-slider");$scope.openOrdem=false;$rootScope.itensOrdemModuloSortable="";optionsCombo();optionsModal();optionsGrid();}
init();});$app.controller('MenusController',function($scope,$resource,AuthService,CSRF_TOKEN){$scope.title="Menus";$scope.content='menus';$scope.window={new:function(){$scope.dataItem={titulo:"",apelido:""};$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Adicionar Menu"});$scope.modal.open().center();},edit:function(dataItem){$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Menu: "+dataItem.id});$scope.modal.open().center();$scope.dataItem=dataItem;},close:function(){$scope.modal.close();}}
$scope.executeAction=function(action){switch(action){case"create()":createMenu();break;case"update()":updateMenu();break;}}
createMenu=function(){if(AuthService.checkCreate("menus",true)){var user=$resource("/admin/menus",{_token:CSRF_TOKEN});$scope.loaderForm=true;user.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={titulo:"",apelido:""};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
updateMenu=function(){if(AuthService.checkUpdate("menus",true)){var user=$resource("/admin/menus",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;user.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("menus",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var user=$resource("/admin/menus");$scope.loaderForm=true;user.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
$scope.setContent=function(content,dataItem){if(content=='menu_itens'){$scope.menuSelecionado=dataItem;$scope.title="Menu: "+dataItem.titulo;$scope.content=content;}else{$scope.title="Menus";$scope.content=content;}}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/menus/grid'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:"data",total:"total",model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"titulo",title:"Titulo",type:"string"},{field:"apelido",title:"Apelido",type:"string"},{command:[{template:"<button class=\'k-button\' ng-disabled='access_update == false' ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\' ng-disabled='access_destroy == false' ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\' ng-disabled='access_destroy == false' ng-click=\'setContent(\"menu_itens\",dataItem)\'>Itens</button>"}]}]}}
optionsModal=function(){$scope.conf_modal={title:'Menus',width:'500',height:'300',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}}
init=function(){AuthService.checkView("menus");optionsGrid();optionsModal();}
init();});$app.controller('MenuItensController',function($scope,$rootScope,$resource,ListDataService,AuthService,MenuService,CSRF_TOKEN,$compile,$timeout){$scope.title="Menus";$scope.paramsOrdem="";$scope.openOrdem=false;$scope.displayGridMenuItens=false;var comboItemPai="";$scope.window={new:function(){$scope.dataItem={tipo_descricao:"",tipo:"",componente:"",titulo:"",apelido:"",publicado:true,pagina_inicial:false,item_pai:0,menu_id:$scope.menuSelecionado.id,meta_title:"",meta_description:"",meta_keywords:"",meta_author:"",parametros:{class:"",mostrar_cabecalho:false,subtitulo:""}};$scope.formView="new";$scope.formAction="create()";$scope.modal_item.setOptions({title:"Adicionar Item de Menu"});setParametrosHtml("");$scope.modal_item.open().center();refreshComboItemPai();},edit:function(dataItem){$scope.dataItem=dataItem;$scope.getTipoMenu(dataItem.componente,dataItem.tipo,dataItem.tipo_descricao,'edit');$scope.dataItem.parametros=angular.fromJson(dataItem.parametros);formataTitulo(dataItem.titulo);$scope.formView="edit";$scope.formAction="update()";$scope.modal_item.setOptions({title:"Editar Item de Menu: "+dataItem.id});$scope.modal_item.open().center();refreshComboItemPai();},tipo:function(){$scope.modal_item_tipo.open().center();},ordem:function(dataItem){$scope.data=$scope.grid.dataSource.data();$scope.paramsOrdem=dataItem;$scope.dataItem=dataItem;$scope.openOrdem=true;$scope.modal_ordem.open().center();},close_ordem:function(){$scope.openOrdem=false;$rootScope.itensOrdemSortable="";$scope.modal_ordem.close();},close_tipo:function(){$scope.modal_item_tipo.close();},close:function(){$scope.modal_item.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("menus",true)){var request=$resource("/admin/menu-itens",{_token:CSRF_TOKEN});$scope.loaderForm=true;request.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={tipo_descricao:"",tipo:"",componente:"",titulo:"",apelido:"",publicado:true,pagina_inicial:false,item_pai:0,menu_id:$scope.menuSelecionado.id,meta_title:"",meta_description:"",meta_keywords:"",meta_author:"",parametros:{class:"",mostrar_cabecalho:false,subtitulo:""}};$scope.grid.refresh();$scope.grid.dataSource.read();refreshComboItemPai();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("menus",true)){var request=$resource("/admin/menu-itens",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;request.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("menus",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var request=$resource("/admin/menu-itens");$scope.loaderForm=true;request.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.refresh();$scope.grid.dataSource.read();refreshComboItemPai();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
$scope.optionsGrid=function(dataItem){$scope.menuSelecionado=dataItem;optionsCombo(dataItem);return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/menu-itens/grid?menu_id='+dataItem.id},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:function(response){comboItemPai=response.combo_item_pai;return response.data;},total:function(response){return response.total;},model:{id:"id",fields:{id:{field:"id",type:"number"},item_pai:{field:"item_pai",type:"number"}},itemPaiTitulo:function(){return ListDataService.getForeignText(comboItemPai,this.get("item_pai"));}},}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,autoBind:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='$parent.setContent(\"menus\")'>Voltar</button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"titulo",title:"Titulo",type:"string",template:"<div ng-bind-html-custom='{{dataItem.titulo}}' />"},{field:"apelido",title:"Apelido",type:"string"},{field:"pagina_inicial",template:"<div style='text-align:center;' ng-pagina-inicial='dataItem'></div>",title:"Página Inicial",type:"string"},{field:"item_pai",template:function(dataItem){return ListDataService.getForeignText(comboItemPai,dataItem.item_pai);},title:"Item Pai",type:"number",filterable:false},{field:"ordem",title:"Ordem",type:"number"},{command:[{template:"<button class=\'k-button\' ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\' ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\' ng-click=\'window.ordem(dataItem)\'>Ordem</button>"}]}],}
function itemPaiFilter(element){element.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:{data:angular.fromJson(comboItemPai)},optionLabel:"--Select Value--"});}}
optionsModal=function(){$scope.conf_modal_item={title:'Item de Menu',width:'1000',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}
$scope.conf_modal_item_tipo={title:'Tipo de Menu',width:'500',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}
$scope.conf_modal_ordem={title:'Ordem',width:'400',height:'500',actions:["Minimize","Maximize"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}}
optionsCombo=function(dataItem){$scope.comboItemPai={filter:'contains',dataTextField:"titulo",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/menu-itens/combo-item-pai?menu_id="+dataItem.id,async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}}
$scope.getTipoMenu=function(componente,tipo,descricao,acao){if(acao=='create'){$scope.dataItem.componente=componente;$scope.dataItem.tipo_descricao=descricao;$scope.dataItem.tipo=tipo;}
switch(tipo){case'unico-artigo':if(acao=='create'){$scope.dataItem.parametros.artigo_id="";}
setParametrosHtml(MenuService.parametrosUnicoArtigo());optionsUnicoArtigo();break;case'categoria-de-artigo':if(acao=='create'){$scope.dataItem.parametros.categoria_id="";$scope.dataItem.parametros.categoria_template="";}
setParametrosHtml(MenuService.parametrosCategoriaArtigo());optionsCategoriaArtigo();break;case'unico-contato':if(acao=='create'){$scope.dataItem.parametros.contato_id="";}
setParametrosHtml(MenuService.parametrosUnicoContato());optionsUnicoContato();break;}}
$scope.updateOrdem=function(){if(AuthService.checkUpdate("menus")){var request=$resource("/admin/menu-itens/updateOrdem",{_token:CSRF_TOKEN},{update:{method:"PUT"}});var data={itens:$rootScope.itensOrdemSortable}
$(".status-ordem-modulo").addClass('btn-primary').html("<span>Alterando Ordem...</span>");var request=$resource('/admin/menu-itens/updateOrdem',{_token:CSRF_TOKEN},{update:{method:"PUT"}});if($rootScope.itensOrdemSortable==""){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");}else{$(".status-ordem-modulo").removeClass('btn-success bt-danger').addClass('btn-primary').html("<span>Alterando Ordem</span>");request.update(data,function(response){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");$scope.grid.dataSource.read();},function(response){alert('error');})}}}
setParametrosHtml=function(parametros){var el=angular.element(parametros);var compiled=$compile(el)($scope);$('.parametros-configuracao').html(compiled);}
optionsUnicoArtigo=function(){$scope.comboArtigos={filter:'contains',dataTextField:"titulo",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/conteudo/artigos/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}}
optionsCategoriaArtigo=function(){$scope.comboCategoriaArtigos={filter:'contains',dataTextField:"descricao",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/conteudo/artigo-categorias/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboCategoriaArtigoTemplate={filter:'contains',dataTextField:"text",dataValueField:"value",dataSource:{data:[{text:'Padrão',value:'padrao.html'}]}}}
optionsUnicoContato=function(){$scope.comboContatos={filter:'contains',dataTextField:"titulo",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/componentes/contatos/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}}
refreshComboItemPai=function(){var combo=$("#comboItemPai").data('kendoComboBox');combo.dataSource.read();}
formataTitulo=function(titulo){var span=titulo.match(/(<span class="icon-arrow-right-2">)([\s\S]*?)(<\/span>)/g);var string="";angular.forEach(span,function(v,k){string+=v;});$scope.dataItem.titulo=$scope.dataItem.titulo.replace(string,"");}
init=function(){AuthService.checkView("menus");optionsGrid();optionsModal();}
init();});$app.controller('MidiasController',function($scope,$http,$window,$location,$resource,AuthService){$scope.title="Mídias";init=function(){AuthService.checkView("midias");}
init();});$app.controller('ArtigosController',function($timeout,$rootScope,$scope,$http,$window,$location,$resource,AuthService,ListDataService,CSRF_TOKEN){$scope.title="Artigos";$scope.editorDescricao=false;$scope.editorMiniDescricao=false;var comboCategoriaGrid="";$scope.window={new:function(){$scope.dataItem={titulo:"",apelido:"",artigo_categoria_id:"",publicado:true,destaque:false,mostrar_titulo:false,tag_titulo:"h1",mini_descricao:"",descricao:"",meta_title:"",meta_description:"",meta_keywords:"",meta_author:"",parametros:{template:"padrao.html",class:'',id:''}};$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Adicionar Artigo"});$scope.modal.open().center();},edit:function(dataItem){$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Artigo: "+dataItem.id});$scope.modal.open().center();$scope.dataItem=dataItem;$scope.dataItem.parametros=angular.fromJson(dataItem.parametros);},close:function(){$scope.modal.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("artigos",true)&&AuthService.checkCreate("conteudo",true)){var user=$resource("/admin/conteudo/artigos",{_token:CSRF_TOKEN});$scope.loaderForm=true;user.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={titulo:"",apelido:"",artigo_categoria_id:"",publicado:true,destaque:false,mostrar_titulo:false,tag_titulo:"h1",mini_descricao:"",descricao:"",meta_title:"",meta_description:"",meta_keywords:"",meta_author:"",parametros:{template:"",class:'',id:''}};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("artigos",true)&&AuthService.checkUpdate("conteudo",true)){var user=$resource("/admin/conteudo/artigos",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;user.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("artigos",true)&&AuthService.checkDelete("conteudo",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var user=$resource("/admin/conteudo/artigos");$scope.loaderForm=true;user.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/conteudo/artigos/grid'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:function(response){comboCategoriaGrid=response.artigo_categoria;return response.data;},total:function(response){return response.total;},model:{id:"id",fields:{id:{type:"number"},artigo_categoria_id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"titulo",title:"Titulo",type:"string"},{field:"apelido",title:"Apelido",type:"string"},{field:"artigo_categoria_id",title:"Categoria",template:function(dataItem){return ListDataService.getForeignText(comboCategoriaGrid,dataItem.artigo_categoria_id);},type:"number",filterable:{ui:artigoCategoriaFilter}},{command:[{template:"<button class=\'k-button\' ng-disabled='access_update == false' ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\' ng-disabled='access_destroy == false' ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}]}]}
function artigoCategoriaFilter(element){element.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:{data:angular.fromJson(comboCategoriaGrid)},optionLabel:"--Select Value--"});}}
optionsModal=function(){$scope.conf_modal={title:'Artigos',width:'1000',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}}
optionsCombo=function(){var pathArtigos='/assets/templates/includes/templates/componentes/artigo/unico-artigo/';$scope.comboCategoria={filter:'contains',dataTextField:"descricao",dataValueField:"id",autoBind:false,dataSource:{transport:{read:{url:"/admin/conteudo/artigo-categorias/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboTemplates={filter:'contains',dataTextField:"file",dataValueField:"file",autoBind:false,dataSource:{transport:{read:{url:"/admin/conteudo/artigos/filesDir?path="+pathArtigos,async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboMostrarTitulo={filter:'contains',dataTextField:"text",dataValueField:"value",autoBind:false,dataSource:{data:[{text:"Não",value:false},{text:"Sim",value:true}]}}
$scope.comboTagTitulo={filter:'contains',dataTextField:"v",dataValueField:"v",autoBind:false,dataSource:{data:[{v:"h1"},{v:"h2"},{v:"h3"},{v:"h4"},{v:"h5"},{v:"h6"}]}}}
$scope.loaderEditorMiniDescricao=function(){$timeout(function(){$scope.editorMiniDescricao=true;},1000);}
$scope.loaderEditorDescricao=function(){$timeout(function(){$scope.editorDescricao=true;},1000);}
init=function(){AuthService.checkView("conteudo");AuthService.checkView("artigos");optionsCombo();optionsGrid();optionsModal();}
init();});$app.controller('ArtigoCategoriasController',function($scope,$http,$window,$location,$resource,AuthService,CSRF_TOKEN){$scope.title="Categorias";$scope.window={new:function(){$scope.dataItem={descricao:"",meta_title:"",meta_description:"",meta_keywords:"",meta_author:"",parametros:{template_categoria:"padrao.html",paginacao:true,paginacao_itens_pagina:10,formulario_busca:true}};$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Adicionar Categoria"});$scope.modal.open().center();},edit:function(dataItem){$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Categoria: "+dataItem.id});$scope.dataItem=dataItem;$scope.dataItem.parametros=angular.fromJson(dataItem.parametros);$scope.modal.open().center();},close:function(){$scope.modal.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("artigo-categorias",true)&&AuthService.checkCreate("conteudo",true)){var user=$resource("/admin/conteudo/artigo-categorias",{_token:CSRF_TOKEN});$scope.loaderForm=true;user.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={descricao:"",meta_title:"",meta_description:"",meta_keywords:"",meta_author:"",parametros:{template_categoria:"padrao.html",paginacao:true,paginacao_itens_pagina:10,formulario_busca:true}};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("artigo-categorias",true)&&AuthService.checkUpdate("conteudo",true)){var user=$resource("/admin/conteudo/artigo-categorias",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;user.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("artigo-categorias",true)&&AuthService.checkDelete("conteudo",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var user=$resource("/admin/conteudo/artigo-categorias");$scope.loaderForm=true;user.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/conteudo/artigo-categorias/grid'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:"data",total:"total",model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"descricao",title:"Descrição",type:"string"},{command:[{template:"<button class=\'k-button\' ng-disabled='access_update == false' ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\' ng-disabled='access_destroy == false' ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}]}]}}
optionsModal=function(){$scope.conf_modal={title:'Categorias',width:'600',height:'450',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}}
optionsCombo=function(){var pathCategoria='/assets/templates/includes/templates/componentes/artigo/categoria-de-artigo/categoria';$scope.comboCategoriaTemplate={filter:'contains',dataTextField:"file",dataValueField:"file",dataSource:{transport:{read:{url:"/admin/conteudo/artigo-categorias/filesDir?path="+pathCategoria,async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("padrao.html");}}}}
init=function(){AuthService.checkView("conteudo");AuthService.checkView("artigo-categorias");optionsGrid();optionsModal();optionsCombo();}
init();});$app.controller('ProdutoCategoriasController',function($timeout,$scope,$rootScope,$resource,AuthService,ListDataService,CSRF_TOKEN){$scope.title="Categoria de Produtos";$scope.editorDescricao=false;$scope.window={new:function(){$scope.openModal=true;$scope.dataItem={titulo:"",apelido:"",publicado:true,descricao:"",meta_title:"",meta_description:"",meta_keywords:"",meta_author:"",parametros:{template:"padrao.html",formulario_busca:true,paginacao:true,paginacao_itens_por_pagina:10,mostrar_titulo:false,tag_titulo:"h1",class:"",id:""}};$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Categoira"});$scope.modal.open().center();$scope.openModal=true;},edit:function(dataItem){$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Categoria: "+dataItem.id});$scope.dataItem=dataItem;$scope.dataItem.parametros=angular.fromJson(dataItem.parametros);$scope.modal.open().center();},close:function(){$scope.modal.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("componente-produtos",true)&&AuthService.checkCreate("componente-produto-categorias",true)&&AuthService.checkCreate("componentes",true)){var request=$resource("/admin/componentes/produtos/produto-categorias",{_token:CSRF_TOKEN});$scope.loaderForm=true;''
request.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={titulo:"",apelido:"",publicado:true,descricao:"",meta_title:"",meta_description:"",meta_keywords:"",meta_author:"",parametros:{template:"padrao.html",formulario_busca:true,paginacao:true,paginacao_itens_por_pagina:10,mostrar_titulo:false,tag_titulo:"h1",class:"",id:""}};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("componente-produtos",true)&&AuthService.checkUpdate("componente-produto-categorias",true)&&AuthService.checkUpdate("componentes",true)){var request=$resource("/admin/componentes/produtos/produto-categorias",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;request.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("componente-produtos",true)&&AuthService.checkDelete("componente-produto-categorias",true)&&AuthService.checkDelete("componentes",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var request=$resource("/admin/componentes/produtos/produto-categorias");$scope.loaderForm=true;request.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/componentes/produtos/produto-categorias/grid'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:"data",total:"total",model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"},boolean:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"titulo",title:"Titulo",type:"string"},{field:"apelido",title:"Apelido",type:"string"},{field:"publicado",title:"Publicado",template:"<publica-in-grid publicado='dataItem.publicado' item='dataItem' grid='grid' url='/admin/componentes/produtos/produto-categorias/updateStatus' permissao='permissaoUpdate'></publica-in-grid>",type:"boolean",filterable:{extra:false,operators:{string:{eq:"Seja igual a",neq:"Não seja igual a"}},ui:publicadoFilter}},{command:[{template:"<button class=\'k-button\'  ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\'  ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}]}]}
function publicadoFilter(element){element.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:{data:[{"text":"Publicado","value":true},{"text":"Despublicado","value":false}]},optionLabel:"--Select Value--"});}}
optionsModal=function(){$scope.conf_modal={title:'Contato',width:'1000',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}}
optionsCombo=function(){var pathTemplates='/assets/templates/includes/templates/componentes/produtos/categoria-de-produto/categoria';$scope.comboPosicao={filter:'contains',dataTextField:"descricao",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/modulo-posicaos/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboTagTitulo={filter:'contains',dataTextField:"v",dataValueField:"v",autoBind:false,dataSource:{data:[{v:"h1"},{v:"h2"},{v:"h3"},{v:"h4"},{v:"h5"},{v:"h6"}]}}
$scope.comboTemplates={filter:'contains',dataTextField:"file",dataValueField:"file",dataSource:{transport:{read:{url:"/admin/componentes/produtos/produto-categorias/filesDir?path="+pathTemplates,async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("padrao.html");}}}}
$scope.loaderEditorDescricao=function(){$timeout(function(){$scope.editorDescricao=true;},500);}
optionsNumeric=function(){$scope.numericOptions={min:1,decimals:0,format:"#"}}
init=function(){AuthService.checkView("componentes");AuthService.checkView("componente-produtos");AuthService.checkView("componente-produto-categorias");$scope.permissaoUpdate=AuthService.checkUpdate("componente-produtos",false)==true&&AuthService.checkUpdate("componente-produto-categorias",false)==true&&AuthService.checkUpdate("componentes",false)==true?true:false;optionsModal();optionsGrid();optionsNumeric();optionsCombo();}
init();});$app.controller('ContatoController',function($timeout,$scope,$rootScope,$resource,AuthService,ListDataService,CSRF_TOKEN){$scope.title="Componente Contato";$scope.editorDescricaoDepois=false;$scope.editorDescricaoAntes=false;$scope.openModal=false;$scope.window={new:function(){$scope.openModal=true;$scope.dataItem={titulo:"",config_global:true,nome_remetente:"",email_remetente:"",autenticacao_email:0,usuario_email:"",senha_email:"",servidor_email:"",porta_email:"",descricao_antes:"",descricao_depois:"",meta_title:"",meta_description:"",meta_keywords:"",meta_author:"",parametros:[]};$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Contato"});$scope.modal.open().center();$scope.openModal=true;},edit:function(dataItem){$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Contato: "+dataItem.id});$scope.modal.open().center();$scope.dataItem=dataItem;$scope.dataItem.parametros=angular.fromJson(dataItem.parametros);if(dataItem.mostrar_titulo==true){$scope.dataItem.mostrar_titulo=1;}
if(dataItem.mostrar_titulo==false){$scope.dataItem.mostrar_titulo=0;}
$scope.openModal=true;},close:function(){$scope.modal.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("componente-contato",true)&&AuthService.checkCreate("componentes",true)){var request=$resource("/admin/componentes/contatos",{_token:CSRF_TOKEN});$scope.loaderForm=true;''
request.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={titulo:"",config_global:true,nome_remetente:"",email_remetente:"",autenticacao_email:0,usuario_email:"",senha_email:"",servidor_email:"",porta_email:"",descricao_antes:"",descricao_depois:"",meta_title:"",meta_description:"",meta_keywords:"",meta_author:"",parametros:[]};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("componente-contato",true)&&AuthService.checkUpdate("componentes",true)){var request=$resource("/admin/componentes/contatos",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;request.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("componente-contato",true)&&AuthService.checkDelete("componentes",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var request=$resource("/admin/componentes/contatos");$scope.loaderForm=true;request.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/componentes/contatos/grid'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:"data",total:"total",model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"titulo",title:"Titulo",type:"string"},{command:[{template:"<button class=\'k-button\'  ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\'  ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}]}]}}
optionsModal=function(){$scope.conf_modal={title:'Contato',width:'1000',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}}
optionsCombo=function(){$scope.comboPosicao={filter:'contains',dataTextField:"descricao",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/modulo-posicaos/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboMostrarTitulo={filter:'contains',dataTextField:"text",dataValueField:"value",autoBind:false,dataSource:{data:[{text:"Não",value:false},{text:"Sim",value:true}]}}
$scope.comboTagTitulo={filter:'contains',dataTextField:"v",dataValueField:"v",autoBind:false,dataSource:{data:[{v:"h1"},{v:"h2"},{v:"h3"},{v:"h4"},{v:"h5"},{v:"h6"}]}}
$scope.comboBanner={filter:'contains',dataTextField:"descricao",dataValueField:"id",dataSource:{transport:{read:{url:"/admin/componentes/contatos/banner-sliders/combo",async:false}}},change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.id==input){search=true;}});if(search==false){this.value("");}}}}
$scope.loaderEditorDescricaoDepois=function(){$timeout(function(){$scope.editorDescricaoDepois=true;},1000);}
$scope.loaderEditorDescricaoAntes=function(){$timeout(function(){$scope.editorDescricaoAntes=true;},1000);}
init=function(){AuthService.checkView("componentes");AuthService.checkView("componente-contato");optionsModal();optionsGrid();}
init();});$app.controller('BannerSlidersController',function($scope,$http,$window,$location,$resource,AuthService,CSRF_TOKEN){$scope.title="Banner Slider";$scope.content="banner";$scope.window={new:function(){$scope.dataItem={descricao:""};$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Adicionar Banner"});$scope.modal.open().center();},edit:function(dataItem){$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Banner: "+dataItem.id});$scope.modal.open().center();$scope.dataItem=dataItem;},close:function(){$scope.modal.close();}}
$scope.executeAction=function(action){switch(action){case"create()":createBanner();break;case"update()":updateBanner();break;}}
createBanner=function(){if(AuthService.checkCreate("componente-banner-slider",true)&&AuthService.checkCreate("componentes",true)){var request=$resource("/admin/componentes/banner-sliders",{_token:CSRF_TOKEN});$scope.loaderForm=true;request.save($scope.dataItem,function(response){switch(response.status){case 0:$scope.loaderForm=false;return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={descricao:""};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
updateBanner=function(){if(AuthService.checkUpdate("componente-banner-slider",true)&&AuthService.checkUpdate("componentes",true)){var user=$resource("/admin/componentes/banner-sliders",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;user.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("componente-banner-slider",true)&&AuthService.checkDelete("componentes",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var user=$resource("/admin/componentes/banner-sliders");$scope.loaderForm=true;user.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/componentes/banner-sliders/grid'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:"data",total:"total",model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"descricao",title:"Descrição",type:"string"},{command:[{template:"<button class=\'k-button\'  ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\'  ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\'  ng-click=\'setContent(\"imagens\",dataItem)\'><span class='k-icon' style='padding:0 2px 0 0;'></span>Imagens</button>"}]}]}}
optionsModal=function(){$scope.conf_modal={title:'Banner Slider',width:'400',height:'200',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}}
$scope.setContent=function(content,dataItem){$scope.content=content;$scope.itemSelected=dataItem;if(content=='imagens'){$scope.title="Banner: "+dataItem.descricao;}else{$scope.title="Banner Slider";}}
init=function(){AuthService.checkView("componentes");AuthService.checkView("componente-banner-slider");optionsGrid();optionsModal();}
init();});$app.controller("BannerSliderFotosController",function($scope,$rootScope,$resource,AuthService,FileService,CSRF_TOKEN){$scope.title="FOTOS";$scope.openOrdem=false;$scope.files=[];$scope.window={new:function(){var combo=$("#comboImagem").data("kendoComboBox");$rootScope.fileImagesService=combo.dataSource.data();$scope.dataItem={titulo:"",alt:"",legenda:"",imagem:"",publicado:true,url:"",url_target:"_self",banner_slider_id:$scope.banner.id};$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Adicionar Fotos"});$scope.modalFotos.open().center();},edit:function(dataItem){var combo=$("#comboImagem").data("kendoComboBox");$rootScope.fileImagesService=combo.dataSource.data();$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Artigo: "+dataItem.id});$scope.modalFotos.open().center();$scope.dataItem=dataItem;},close:function(){$scope.modalFotos.close();},ordem:function(){$scope.paramsOrdem={banner_slider_id:$scope.banner.id};$scope.openOrdem=true;$scope.modalOrdem.open().center();},close_ordem:function(){$scope.modalOrdem.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("componente-banner-slider",true)&&AuthService.checkCreate("componentes",true)){var user=$resource("/admin/componentes/banner-slider-fotos",{_token:CSRF_TOKEN});$scope.loaderForm=true;user.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={titulo:"",alt:"",legenda:"",imagem:"",publicado:true,banner_slide_id:$scope.banner.id};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("componente-banner-slider",true)&&AuthService.checkUpdate("componentes",true)){var request=$resource("/admin/componentes/banner-slider-fotos",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;request.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("componente-banner-slider",true)&&AuthService.checkDelete("componentes",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var user=$resource("/admin/componentes/banner-slider-fotos");$scope.loaderForm=true;user.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
$scope.optionsGrid=function(dataItem){$scope.banner=dataItem;optionsCombo(dataItem);return{dataSource:{type:"json",transport:{read:'/admin/componentes/banner-slider-fotos/grid?banner_slider_id='+dataItem.id},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:"data",total:"total",model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='$parent.setContent(\"banner\")'>Voltar</button>"},{template:"<button class='k-button' ng-click='window.ordem()'>Ordem</button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"imagem",title:"Imagem",type:"string",template:"<img src='/componentes/banner-slider/banner-#=banner_slider_id#/#=imagem#' width='100px;'>",},{field:"titulo",title:"Titulo",type:"string"},{command:[{template:"<button class=\'k-button\'  ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\'  ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}]}]}}
$scope.changeFiles=function(file){FileService.setFile(file[0]);}
$scope.uploadFiles=function(file){var path='componentes/banner-slider/banner-'+$scope.banner.id;FileService.setPath(path);FileService.uploadFiles({refreshCombo:true});}
$scope.deleteFile=function(index){FileService.set
FileService.deleteFile(index);}
$scope.updateOrdem=function(){$(".status-ordem-modulo").addClass('btn-primary').html("<span>Alterando Ordem...</span>");var request=$resource('/admin/componentes/banner-slider-fotos/ordem',{_token:CSRF_TOKEN},{update:{method:"PUT"}});if($rootScope.itensOrdemSortable==""){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");}else{$(".status-ordem-modulo").removeClass('btn-success bt-danger').addClass('btn-primary').html("<span>Alterando Ordem</span>");request.update({itens:$rootScope.itensOrdemSortable},function(response){$(".status-ordem-modulo").removeClass('primary bt-danger').addClass('btn-success').html("<span>Ordem atualizada</span>");},function(response){alert('error');})}}
optionsModal=function(){$scope.conf_modal={title:'Fotos',width:'900',height:'450',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}
$scope.conf_modal_ordem={title:'Ordem Fotos',width:'400',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}},close:function(){$scope.openOrdem=false;$scope.$apply();}}}
optionsCombo=function(dataItem){$scope.comboImagem={filter:'contains',dataTextField:"text",dataValueField:"value",dataSource:{transport:{read:{url:"/admin/files/read_dir?pasta=componentes/banner-slider/banner-"+dataItem.id,async:false}}},template:"<img src='/componentes/banner-slider/banner-"+dataItem.id+"/#=value#' width='100px;'>",change:function(e){var data=this.dataSource.data();var input=this.value();var search=false;angular.forEach(data,function(v,key){if(v.value==input){search=true;}});if(search==false){this.value("");}}}
$scope.comboTarget={filter:'contains',dataTextField:"text",dataValueField:"value",autoBind:false,dataSource:{data:[{text:"Nova Janela",value:"_blank"},{text:"Mesma Janela",value:"_self"}]}}}
init=function(){optionsModal();}
init();});$app.controller('UsuariosController',function($scope,$http,$window,$location,$resource,MenuService,AuthService,CSRF_TOKEN){$scope.title="Usuários";var permissoes=[];var permissoesOut=[];var contemInPermissoesResp="";$scope.window={new:function(){$scope.dataItem={nome:"",nome_usuario:"",email:"",senha:"",ativo:true,permissoes:""};$scope.dataItem.permissoes=getDefaultPermissoes();$scope.formView="new";$scope.formAction="create()";$scope.modal.setOptions({title:"Adicionar Usuário"});$scope.modal.open().center();},edit:function(dataItem){dataItem.senha="";$scope.formView="edit";$scope.formAction="update()";$scope.modal.setOptions({title:"Editar Úsuario: "+dataItem.id});$scope.modal.open().center();$scope.dataItem=dataItem;$scope.dataItem.permissoes=verificaChangePermissoes(dataItem.permissoes);},close:function(){$scope.modal.close();}}
$scope.executeAction=function(action){switch(action){case"create()":create();break;case"update()":update();break;}}
create=function(){if(AuthService.checkCreate("usuarios",true)){var user=$resource("/admin/usuarios",{_token:CSRF_TOKEN});$scope.loaderForm=true;user.save($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.dataItem={nome:"",nome_usuario:"",email:"",senha:"",ativo:true,tipo:0,permissoes:getDefaultPermissoes(),cliente_id:""};$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
update=function(){if(AuthService.checkUpdate("usuarios",true)){var user=$resource("/admin/usuarios",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;user.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.grid.dataSource.read();$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
$scope.delete=function(dataItem){if(AuthService.checkDelete("usuarios",true)){if(confirm("Deseja deletar esse(s) registro(s)?")){var ids=[];var type="single";var id=dataItem.id;if(dataItem=="multiple"){if($(".itemGrid:checked").length==0){alert("Nenhum item marcado.");return false;}
$(".itemGrid:checked").map(function(key,value){ids.push(value.value);});type="multiple";id=ids[0];}
var user=$resource("/admin/usuarios");$scope.loaderForm=true;user.delete({id:id,ids:[ids],type:type,_token:CSRF_TOKEN},function(response){switch(response.status){case 2:alert(response.data);$scope.loaderForm=false;break;default:if(type=="multiple"){displayMessagesArray(response.data);}else{alert(response.data);}
$scope.grid.dataSource.read();$scope.loaderForm=false;break;}},function(response){alert("Error: "+response.data);$scope.loaderForm=false;});}}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/usuarios/grid'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:"data",total:"total",model:{id:"id",fields:{id:{type:"number"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},toolbar:[{template:"<button class='k-button' ng-disabled='access_create == false' ng-click='window.new()'><span class='k-icon k-i-plus' style='padding:0 2px 0 0;'></span></button>"},{template:"<button class='k-button' ng-click='delete(\"multiple\")'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}],columns:[{title:"<input type='checkbox' ng-model='checkAll' />",width:"30px",template:"<input type='checkbox' class='itemGrid' ng-model='itensGrid' ng-value='dataItem.id' ng-checked='checkAll'/>",filterable:false,sortable:false},{field:"id",title:"Id",type:"number",width:"50px"},{field:"nome",title:"Nome",type:"text"},{field:"nome_usuario",title:"Usuário",type:"text"},{field:"email",title:"Email",type:"text"},{command:[{template:"<button class=\'k-button\' ng-disabled='access_update == false' ng-click=\'window.edit(dataItem)\'><span class='k-icon k-i-pencil' style='padding:0 2px 0 0;'></span></button>"},{template:"<button  class=\'k-button\' ng-disabled='access_destroy == false' ng-click=\'delete(dataItem)\'><span class='k-icon k-i-close' style='padding:0 2px 0 0;'></span></button>"}]}]}}
optionsModal=function(){$scope.conf_modal={title:'Usuários',width:'800',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}}
verificaChangePermissoes=function(permissoes){var menu=MenuService.getMenu();var permissoes=angular.fromJson(permissoes);angular.forEach(menu,function(value,key){if(value.itemParent==true){readChildrensChangePermissoes(value,permissoes);}else{var data=contemInPermissoes(value.apelido,permissoes);if(data.resp){var item=data.item;permissoesOut.push(item);}else{var item={display:value.display,nome:value.apelido,view:false,delete:false,create:false,update:false};permissoesOut.push(item);}}});return permissoesOut;}
readChildrensChangePermissoes=function(value,permissoes){var data=contemInPermissoes(value.apelido,permissoes);if(data.resp){var item=data.item;permissoesOut.push(item);}else{var item={display:value.display,nome:value.apelido,view:false,delete:false,create:false,update:false};permissoesOut.push(item);}
angular.forEach(value.itens,function(value,key){if(value.itemParent==true){readChildrensChangePermissoes(value,permissoes);}else{var data=contemInPermissoes(value.apelido,permissoes);if(data.resp){var item=data.item;permissoesOut.push(item);}else{var item={display:value.display,nome:value.apelido,view:false,delete:false,create:false,update:false};permissoesOut.push(item);}}});}
contemInPermissoes=function(apelido,permissoes){contemInPermissoesResp={resp:false,item:[]};angular.forEach(permissoes,function(value,key){if(contemInPermissoesResp.resp==false){if(apelido==value.nome){contemInPermissoesResp.resp=true;contemInPermissoesResp.item=value;}}});return contemInPermissoesResp;}
readChildrensContemInPermissoes=function(){var item={display:value.display,nome:value.apelido,view:true,delete:true,create:true,update:true};permissoes.push(item);angular.forEach(value.itens,function(value,key){if(value.itemParent==true){readChildrens(value);}else{var item={display:value.display,nome:value.apelido,view:true,delete:true,create:true,update:true};permissoes.push(item);}});}
getDefaultPermissoes=function(){var menu=MenuService.getMenu();angular.forEach(menu,function(value,key){if(value.itemParent==true){readChildrens(value);}else{var item={display:value.display,nome:value.apelido,view:true,delete:true,create:true,update:true};permissoes.push(item);}});return permissoes;}
readChildrens=function(value){var item={display:value.display,nome:value.apelido,view:true,delete:true,create:true,update:true};permissoes.push(item);angular.forEach(value.itens,function(value,key){if(value.itemParent==true){readChildrens(value);}else{var item={display:value.display,nome:value.apelido,view:true,delete:true,create:true,update:true};permissoes.push(item);}});}
init=function(){AuthService.checkView("usuarios");optionsGrid();optionsModal();}
init();});$app.controller('SiteConfigController',function($scope,$resource,CSRF_TOKEN,AuthService){$scope.title="Configuração Global";$scope.save=function(){if(AuthService.checkUpdate("configuracao-global",true)){$scope.loaderForm=true;var request=$resource("/admin/site-configs",{_token:CSRF_TOKEN},{update:{method:"PUT"}});$scope.loaderForm=true;request.update($scope.dataItem,function(response){switch(response.status){case 0:return displayErrors(response.data);break;case 1:alert(response.data);$scope.loaderForm=false;break;case 2:alert(response.data);$scope.loaderForm=false;break;}},function(response){$scope.loaderForm=false;});}}
displayMessagesArray=function(data){var messages="";angular.forEach(data,function(value,key){messages+=value+"\n";});alert(messages);}
displayErrors=function(errors){var messages="";angular.forEach(errors,function(value,key){if(value.length>1){angular.forEach(value,function(value,key){messages+=value+"\n";});}else{messages+=value+"\n";}});alert(messages);$scope.loaderForm=false;}
optionsCombo=function(){$scope.comboSeguranca={filter:'contains',dataTextField:"text",dataValueField:"value",dataBind:false,dataSource:{data:[{text:"SSL",value:1},{text:"TSL",value:2}]}}}
getConfig=function(){var request=$resource('/admin/site-configs/get');request.get(function(response){$scope.dataItem=response;$scope.dataItem.parametros=angular.fromJson($scope.dataItem.parametros);})}
init=function(){AuthService.checkView("configuracao-global");optionsCombo();getConfig();}
init();});$app.controller('LogsController',function($scope,$resource,AuthService,$sce){$scope.title='Logs';var comboTabelasGrid="";var comboUsuariosGrid="";$scope.window={detalhe:function(dataItem){$scope.dataItem=dataItem;$scope.data_log=dataItem.created_at;$scope.valor_novo=dataItem.valor_novo;$scope.valor_antigo=dataItem.valor_antigo;$scope.dataObservacoes=JSON.parse(dataItem.observacoes);$scope.observacoes=[];angular.forEach($scope.dataObservacoes,function(value,key){var i=key;var v=value.toString();if(key=="permissoes"){v=formatPermissoes(value);}
if(key!="updated_at"&&key!="created_at"){$scope.observacoes.push({index:i,valor:v});}});checkTableUsuarios(dataItem);$scope.modal.setOptions({title:"Log "+dataItem.id});$scope.modal.open().center();},close:function(){$scope.modal.close();}}
checkTableUsuarios=function(data){if(data.tabela=="usuarios"&&data.acao=="update"&&data.campo=="permissoes"){$scope.valor_antigo=formatPermissoes(data.valor_antigo);$scope.valor_novo=formatPermissoes(data.valor_novo);}}
formatDateTime=function(date){var data=date.substring(0,10).split('-');var hora=date.substring(11,19);return data[2]+"/"+data[1]+"/"+data[0]+" - "+hora;}
formatPermissoes=function(permissoes){var data=JSON.parse(permissoes);var html="";var view="";var create="";var update="";var destroy="";angular.forEach(data,function(value,key){view=value.view==true?"<span class='icon icon-checkmark'></span>":"<span class='icon icon-cancel'></span>";create=value.create==true?"<span class='icon icon-checkmark'></span>":"<span class='icon icon-cancel'></span>";update=value.update==true?"<span class='icon icon-checkmark'></span>":"<span class='icon icon-cancel'></span>";destroy=value.delete==true?"<span class='icon icon-checkmark'></span>":"<span class='icon icon-cancel'></span>";html+="<strong>"+value.display+"</strong><br>";html+=" View: "+view;html+=" Create: "+create;html+=" Update: "+update;html+=" Delete: "+destroy+"<br>";});return html;}
optionsGrid=function(){return $scope.optionsGrid={dataSource:{type:"json",transport:{read:'/admin/logs/grid'},serpageSize:10,serverPaging:true,serverFiltering:true,serverSorting:true,schema:{data:function(response){comboTabelasGrid=response.tabelas;comboUsuariosGrid=response.usuarios;return response.data;},total:function(response){return response.total;},model:{id:"id",fields:{id:{type:"number"},created_at:{type:"date"}}}}},sortable:true,reorderable:true,resizable:true,mobile:true,selectable:true,groupable:{messages:{empty:"Arraste uma coluna para agrupar"}},pageable:{refresh:true,pageSize:10,pageSizes:true,messages:{display:"{0} - {1} de {2} itens",empty:"Não Existem Itens para mostrar",page:"Página",of:"de {0}",itemsPerPage:"itens por Página",first:"Primeira Página",previous:"Página Anterior",next:"Próxima Página",last:"Última Página",refresh:"Atualizar",}},filterable:{extra:true,messages:{clear:"Limpar",filter:"buscar",info:"Registros que:",and:"e",or:"ou",selectValue:"Selecione",},operators:{string:{startswith:"Começa com",endswith:"Termina com",eq:"Seja igual a",neq:"Não é igual a",contains:"Contém",doesnotcontain:"Não contém",},date:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},number:{eq:"Igual a",gte:"Maior ou igual a",gt:"Maior que",lte:"Menor ou igual a",lt:"Menor que"},enums:{eq:"Seja igual a",neq:"Não é igual a"}}},tolbar:[],columns:[{field:"id",title:"Id",type:"number",width:"50px"},{field:"nome_usuario",title:"Nome Usuário",type:"text",filterable:{ui:usuariosFilter}},{field:"tabela",title:"Tabela",type:"text",filterable:{ui:tabelasFilter}},{field:"acao",title:"Ação",type:"text"},{field:"created_at",title:"Data",type:"date",format:"{0:dd-MM-yyyy HH:mm:ss}",filterable:{ui:DateTimePicker}},{command:[{template:"<button class=\'k-button\' ng-disabled='' ng-click=\'window.detalhe(dataItem)\'><span class='icon-eye-2' style='padding:0 2px 0 0;'></span></button>"},]}]}
function tabelasFilter(element){element.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:{data:angular.fromJson(comboTabelasGrid)},optionLabel:"--Select Value--"});}
function usuariosFilter(element){element.kendoDropDownList({dataTextField:"text",dataValueField:"value",dataSource:{data:angular.fromJson(comboUsuariosGrid)},optionLabel:"--Select Value--"});}
function DateTimePicker(element){element.kendoDateTimePicker({culture:"pt-BR",format:"dd-MM-yyyy HH:mm:ss"})}}
optionsModal=function(){$scope.conf_modal={title:'Log',width:'800',height:'500',actions:["Minimize","Maximize","Close"],visible:false,modal:true,resizable:true,animation:{close:{duration:200},open:{duration:200}}}}
init=function(){AuthService.checkView("logs");optionsGrid();optionsModal();}
init();});$app.controller('HomeController',function($scope,$http,$window,$location,$resource,AuthService){$scope.title="Home";init=function(){AuthService.checkView("home");}
init();});$app.controller("AuthController",function($scope,$rootScope,$resource,CSRF_TOKEN,$timeout,AuthService,$location){$scope.title="Login";$scope.loaderLogin=false;$scope.displayRespLogin=false;$scope.user={nome_usuario:"",senha:""};$scope.login=function(){$scope.loaderLogin=true;var user=$resource('/admin/auth/login',{_token:CSRF_TOKEN},{post:{method:"POST"}});user.post($scope.user,function(response){if(response.status==0){$scope.loaderLogin=false;readErrors(response.data);}else{var user=response.data;AuthService.setLogin(user);AuthService.setPermissoes(user[0].permissoes);$location.path("/admin");}},function(response){$scope.respLogin="Erro no servidor.";$scope.loaderLogin=false;$scope.displayRespLogin=true;});}
$scope.logout=function(){var user=$resource('/admin/auth/logout',{_token:CSRF_TOKEN},{post:{method:"POST"}});$scope.loaderLogout=true;user.post(function(response){$(".content-right").attr("style","");$(".page-content").html("");$rootScope.loginUser=false;$rootScope.currentLink="/admin/login";$timeout(function(){$location.path('/admin/login');},500);$scope.loaderLogout=false;},function(response){alert("Erro no Servidor.");$scope.loaderLogout=false;});}
readErrors=function(messages){var data=messages;$scope.respLogin="";angular.forEach(data,function(value,key){$scope.respLogin+=value+"<br>";if(value.length>1){angular.forEach(value,function(value,key){$scope.respLogin+=value+"<br>";});}});$timeout(function(){$scope.displayRespLogin=true;},500);}});