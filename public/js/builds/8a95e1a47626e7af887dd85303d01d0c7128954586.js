$app.directive('bannerSliderCycle',function(){return{restrict:'A',scope:{parametros:"=parametros"},link:function(scope,element,attrs,model){var options=angular.fromJson(scope.parametros);var img=$(element).parent().find('.cycle-image-first');element.cycle({fx:options.efeito,easing:'easeOutBack',loader:"wait",slides:'.itemCycle',pager:parseInt(options.paginacao)==1?$(element).parent().find("#pager"):null,prev:parseInt(options.prev)==1?$(element).parent().find("#prev"):null,next:parseInt(options.next)==1?$(element).parent().find("#next"):null,timeout:options.timeout,speed:options.speed,pause:parseInt(options.pause),containerResize:0,width:'100%',fit:1,after:function(){},pagerAnchorBuilder:function(idx,slide){if(parseInt(options.paginacao)==1){var src=$(slide).find('img').attr('src');return'<li><a href="#"><img src="'+src+'" width="50" height="50" /></a></li>';}}});$(img).load(function(){element.css({'height':$(this).height()+"px",});});$(window).resize(function(){var img=$(element).parent().find('.cycle-image-first');element.css({'height':img.height()+"px",});});}}});$app.directive('modulo',function($resource,$compile,$rootScope,MODULOS){return{restrict:"E",link:function(scope,element,attrs,model){var request=$resource('/CmsModulos/get-modulos-posicao');var data={posicao:attrs.posicao};var modulos_all=MODULOS;var modulos=searchModulos(modulos_all,attrs.posicao);if(modulos.length>0){angular.forEach(modulos,function(v,k){scope.modulo=v;var m=getModulo(v);var el=angular.element(m);var compile=$compile(el)(scope);element.append(compile);});}
function searchModulos(data,posicao){var modulos=[];angular.forEach(data,function(v,k){if(v.descricao==posicao){modulos.push(v);}});return modulos;}
function getModulo(modulo){switch(modulo.tipo){case'html':return"<modulo-html></modulo-html>";break;case'banner-slider':return"<modulo-banner-slider></modulo-banner-slider>";break;case'contato':return"<modulo-contato></modulo-contato>";break;case'menu':return"<modulo-menu></modulo-menu>";break;}}}}});$app.directive('moduloHtml',function($compile,$rootScope){return{restrict:"E",replace:true,scope:true,link:function(scope,element,attrs,model){var html="";var data=scope.modulo;var conteudo=data.conteudo;var titulo=data.titulo;var mostrar_titulo=data.mostrar_titulo;var tag_titulo=data.tag_titulo;var parametros=angular.fromJson(data.parametros);html+="<div class='modulo-html "+parametros.class+"' id='"+parametros.id+"'>";if(mostrar_titulo==true){html+="<"+tag_titulo+">"+titulo+"</"+tag_titulo+">";}
html+=conteudo;html+="</div>";var el=angular.element(html);var compile=$compile(el)(scope);element.html(compile);}}});$app.directive('moduloBannerSlider',function($resource,$compile,$http,$q){return{restrict:"E",scope:true,link:function(scope,element,attrs,model){var html="";var data=scope.modulo;var titulo=data.titulo;var mostrar_titulo=data.mostrar_titulo;var tag_titulo=data.tag_titulo;var parametros=angular.fromJson(data.parametros);var request=$resource('/CmsModulos/banner-sliders/get-fotos',{banner_id:parametros.banner_id});if(mostrar_titulo==true){html+="<"+tag_titulo+">"+titulo+"</"+tag_titulo+">";}
request.query(function(response){scope.modulo=data;var banner=response;var li="";var image_first="";var altura_inicial="";html+="<section class='"+parametros.class+" banner-slider-cycle' id='"+parametros.id+"'>";html+="<nav banner-slider-cycle parametros='modulo.parametros' class='cycle'>";angular.forEach(banner,function(v,k){var image="/componentes/banner-slider/banner-"+v.banner_slider_id+"/"+v.imagem;if(k==0){image_first="<img src='"+image+"' style='display:none;' class='cycle-image-first'/>"}
if(v.url.length>0){html+="<div class='itemCycle'>";html+="<a href='"+v.url+"' target='"+v.url_target+"'>";html+="<img src='"+image+"'>";if(v.legenda.length>0){html+="<div class='cycle-legenda'><div class='body'>";html+=v.legenda;html+="</div></div>";}
html+="</a>";html+="</div>";}else{html+="<div class='itemCycle'>";html+="<img src='"+image+"'>";if(v.legenda.length>0){html+="<div class='cycle-legenda'><div class='body'>";html+=v.legenda;html+="</div></div>";}
html+="</div>";}
li+="<li><a href='#'><img src='"+image+"' width='50px' /></a></li>";});html+="</nav>";if(parseInt(parametros.next)==1||parseInt(parametros.prev)==1){html+="<div class='clear'></div>";}
if(parseInt(parametros.prev)==1){html+="<div id='prev' class='cycle-prev'><span class='icon-arrow-left-2'></span></div>";}
if(parseInt(parametros.next)==1){html+="<div id='next' class='cycle-next'><span class='icon-arrow-right-2'></span></div>";}
var navs="";if(parseInt(parametros.paginacao)){navs+="<div class='cycle-pager'>";navs+="<ul id='pager'>";navs+="</ul>";navs+="</div>";}
navs+=image_first;navs+="</section>";var el=angular.element(html+navs);compiled=$compile(el)(scope);element.html(compiled).show('fade');},function(response){});}}});$app.directive('moduloContato',function($compile,$resource){return{restrict:"E",scope:true,link:function(scope,element,attrs,model){var data=scope.modulo;var titulo=data.titulo;var mostrar_titulo=data.mostrar_titulo;var tag_titulo=data.tag_titulo;var parametros=angular.fromJson(data.parametros);var el=angular.element("<h1>TESTE</h1 >");var compiled=$compile(el)(scope);element.html(compiled);}}});$app.directive('moduloMenu',function($compile,$resource,$rootScope){return{restrict:"E",scope:true,link:function(scope,element,attrs,model){var data=scope.modulo;var titulo=data.titulo;var mostrar_titulo=data.mostrar_titulo;var tag_titulo=data.tag_titulo;var parametros=angular.fromJson(data.parametros);var html="";html+="<div class='modulo-menu "+parametros.class+"' id='"+parametros.id+"'>";if(mostrar_titulo==true){html+="<"+tag_titulo+">"+titulo+"</"+tag_titulo+">";}
html+="<modulo-menu-"+parametros.menu_template+" parametros='modulo.parametros'></modulo-menu-"+parametros.menu_template+">";html+="</div>";var el=angular.element(html);var compiled=$compile(el)(scope);element.html(compiled);}}});$app.directive('moduloMenuPadrao',function($compile,$location,$rootScope,$resource,MenuService){return{restrict:"AE",scope:true,template:"<nav class='modulo-menu-padrao'><ul></ul></nav>",link:function(scope,element,attrs,model){var parametros=angular.fromJson(scope.modulo.parametros);var request=$resource('CmsModulos/menus/getMenu');request.query({menu_id:parametros.menu_id},function(response){var menu_itens=response;var menuHtml="";var href="";angular.forEach(menu_itens,function(v,k){var apelido=v.apelido[0]=='/'?v.apelido:"/"+v.apelido;href=v.pagina_inicial==true?'/':apelido;if(MenuService.contemItemPai(menu_itens,v.id)){menuHtml+="<li>";menuHtml+="<a href='"+href+"' title='"+v.titulo+"' class='item-parent' menu-dropdown>";menuHtml+=v.titulo;menuHtml+="<span class='icon icon-arrow-right-2'></span>"
menuHtml+="</a>";menuHtml+="<ul class='sub-itens'>";angular.forEach(v.itens,function(v,k){menuHtml+="<li>";menuHtml+="<a href='"+href+"' title='"+v.titulo+"' ng-class='{active:currentLink == \""+href+"\"}'>";menuHtml+=v.titulo;menuHtml+="</a>";menuHtml+="</li>";});menuHtml+="</ul>";menuHtml+="</li>";}else{menuHtml+="<li>";menuHtml+="<a class='' href='"+href+"' title='"+v.titulo+"' ng-class='{active:currentLink == \""+href+"\"}'>";menuHtml+=v.titulo;menuHtml+="</a>";menuHtml+="</li>";}});var el=angular.element(menuHtml);var compiled=$compile(el)(scope);element.find('ul').html(compiled);},function(response){element.html("Erro ao carregar menu.");});}}});$app.directive('menuPrincipal',function(MenuService,$compile){return{restrict:"E",template:"<nav class='menu'><ul class='menu-body'></ul></div></nav>",link:function(scope,element,attrs,model){var menu=MenuService.getMenu();var menuHtml="";angular.forEach(menu,function(v,k){if(v.itemParent==false){menuHtml+="<li>";menuHtml+="<a href='"+v.href+"' title='"+v.title+"' ng-class='{active:currentLink == \""+v.href+"\"}'>";menuHtml+=v.display;menuHtml+="</a>";menuHtml+="</li>";}else{menuHtml+="<li>";menuHtml+="<a href='"+v.href+"' title='"+v.title+"' class='item-parent' menu-dropdown>";menuHtml+=v.display;menuHtml+="<span class='icon icon-arrow-right-2'></span>"
menuHtml+="</a>";menuHtml+="<ul class='sub-itens'>";angular.forEach(v.itens,function(v,k){menuHtml+="<li>";menuHtml+="<a href='"+v.href+"' title='"+v.title+"' ng-class='{active:currentLink == \""+v.href+"\"}'>";menuHtml+=v.display;menuHtml+="</a>";menuHtml+="</li>";});menuHtml+="</ul>";menuHtml+="</li>";}});var el=angular.element(menuHtml);compiled=$compile(el)(scope);element.find('ul').html(compiled);}}});$app.directive('ngHtml',function($compile){return{restrict:'AE',scope:{html:"=ngHtml"},link:function(scope,element,attrs,model){var html=angular.element(scope.html);var el=$compile(html)(scope);element.html(el);}}});$app.directive('componente',function($resource,$compile,ComponenteService){return{restrict:'AE',scope:true,link:function(scope,element,attr,model){var link=scope.linkData[0];var meta_tags={title:link.meta_title,description:link.meta_description,keywords:link.meta_keywords,author:link.meta_author};scope.link=angular.fromJson(link);scope.link_parametros=angular.fromJson(link.parametros);ComponenteService.setMetaTags(meta_tags);var componenteTemplate=ComponenteService.getComponenteTemplate(link.componente,link.tipo);var el=angular.element(componenteTemplate);var compile=$compile(el)(scope);element.html(compile);}}});$app.directive('componenteUnicoArtigo',function($resource,$compile,$http){return{restrict:'AE',scope:true,link:function(scope,element,attr,model){var data=scope.linkData[0];var parametros=angular.fromJson(data.parametros);var request=$resource("CmsComponentes/componente-artigos/getArtigo",{artigo_id:parametros.artigo_id});request.query(function(response){scope.artigo=response[0];scope.artigo_titulo="<"+scope.artigo.tag_titulo+">"+scope.artigo.titulo+"</"+scope.artigo.tag_titulo+">";scope.artigo_parametros=angular.fromJson(response[0].parametros);var templateUrl='/assets/templates/padrao/templates/componentes/artigo/unico-artigo.html';var html="<div ng-include src=\"'"+templateUrl+"'\" />";var el=angular.element(html);var compile=$compile(el)(scope);element.html(compile);});}}});