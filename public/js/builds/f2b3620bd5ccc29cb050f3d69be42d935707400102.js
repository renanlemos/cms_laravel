$app.directive('ordemModulo',function($resource,$rootScope){return{restrict:"E",scope:{modulo_posicao_id:"=id"},template:"<div class='row-fluid status-ordem-modulo'></div><div class='content-ordem-modulo'><ul class='nav nav-ordem-modulo' sortable-ordem-modulo='itensSortable'><li ng-repeat='o in ordemItens' id='item_{{o.id}}'>{{$index+1}} - {{o.titulo}}</li></ul></div>",link:function(scope,element,attrs,modelCtrl){var request=$resource('/admin/modulos/getModulosOrdem');element.find(".status-ordem-modulo").addClass('btn-primary').html("<span>Carregando Módulos...</span>");request.query({modulo_posicao_id:scope.modulo_posicao_id},function(response){scope.ordemItens=response;element.find(".status-ordem-modulo").addClass('btn-success').removeClass('btn-danger btn-primary').html("<span>"+response.length+" módulos Carregados.</span>");},function(error){element.find(".status-ordem-modulo").addClass('btn-danger').removeClass('btn-success btn-primary').html("<span>Erro Carregar Módulos.</span>");});}}});$app.directive('sortableOrdemModulo',function($rootScope){return{restrict:'A',link:function(scope,element,attrs,model){element.sortable({cursor:'move',items:'li',update:function(){$rootScope.itensOrdemModuloSortable=element.sortable('toArray');$rootScope.$apply();}});element.disableSelection();}}});$app.directive('sortableModuloProdutos',function($rootScope){return{restrict:'A',scope:true,link:function(scope,element,attrs,model){element.sortable({cursor:'move',items:'li',update:function(){var data=element.sortable('toArray');var produtos=scope.dataItem.parametros.produtos;var itens=[];angular.forEach(data,function(value,key){var id=value.split('_');var produto=getItem(id[1]);itens.push(produto);});function getItem(id){var item=[];angular.forEach(produtos,function(v,k){if(item.length==0){if(v.id==id){item=v;}}});return item;}
scope.dataItem.parametros.produtos=itens;scope.$apply();}});element.disableSelection();}}});$app.directive("maskInput",function(){return{restrict:'A',scope:{format:"@format"},link:function(scope,elem,attrs,model){elem.mask(scope.format);}}});$app.directive("ngBindHtmlCustom",function(){return{restrict:'A',scope:{value_html:"@ngBindHtmlCustom"},link:function(scope,elem,attrs,model){elem.html(scope.value_html);}}});$app.directive('uppercase',function(){return{require:'ngModel',link:function(scope,element,attrs,modelCtrl){var uppercase=function(inputValue){uppercase=inputValue.toUpperCase();uppercase=uppercase.replace(new RegExp(/[~{}'~:;^`'´".,?ª!@#¨&]/g),"");uppercase=uppercase.replace(new RegExp(/[ÁÃÂÀÂ]/g),"A");uppercase=uppercase.replace(new RegExp(/[ÍÌÎ]/g),"I");uppercase=uppercase.replace(new RegExp(/[ÉÈÊ]/g),"E")
uppercase=uppercase.replace(new RegExp(/[ÒÓÕÔ]/g),"O")
uppercase=uppercase.replace(new RegExp(/[ÚÙÛ]/g),"U")
if(uppercase!==inputValue){modelCtrl.$setViewValue(uppercase);modelCtrl.$render();}
return uppercase;}
modelCtrl.$parsers.push(uppercase);uppercase(scope[attrs.ngModel]);}};});$app.directive('lowercase',function(){return{require:'ngModel',link:function(scope,element,attrs,modelCtrl){var lowercase=function(inputValue){lowercase=inputValue.toLowerCase();lowercase=lowercase.replace(new RegExp(/[$'~:;^`'´".,?(){}ª!@#¨&_]/g),"");lowercase=lowercase.replace(new RegExp(/[áãâà]/g),"a");lowercase=lowercase.replace(new RegExp(/[íìî]/g),"i");lowercase=lowercase.replace(new RegExp(/[éèê]/g),"e")
lowercase=lowercase.replace(new RegExp(/[òóôõ]/g),"O")
lowercase=lowercase.replace(new RegExp(/[úùû]/g),"u")
if(lowercase!==inputValue){modelCtrl.$setViewValue(lowercase);modelCtrl.$render();}
return lowercase;}
modelCtrl.$parsers.push(lowercase);lowercase(scope[attrs.ngModel]);}};});$app.directive("ngHtmlWithScope",function($compile){return{restrict:'A',scope:{html:"@ngHtmlWithScope"},link:function(scope,element,attrs,model){scope.$watch('html',function(){var el=angular.element(scope.html);var compiled=$compile(el)(scope);element.html(compiled);});}}});$app.directive('menuAdmin',function(MenuService,$compile){return{restrict:"E",template:"<ul class='menu-body'></ul>",link:function(scope,element,attrs,model){var menu=MenuService.getMenu();var menuHtml="";angular.forEach(menu,function(v,k){if(v.itemParent==false){menuHtml+="<li>";menuHtml+="<a href='"+v.href+"' title='"+v.title+"' ng-class='{active:currentLink == \""+v.href+"\"}'>";menuHtml+=v.display;menuHtml+="</a>";menuHtml+="</li>";}else{menuHtml+=readItensParent(v);}});var el=angular.element(menuHtml);compiled=$compile(el)(scope);element.find('ul').html(compiled);}}
function readItensParent(v){var menuHtml="";menuHtml+="<li>";menuHtml+="<a href='"+v.href+"' title='"+v.title+"' class='item-parent' menu-dropdown>";menuHtml+=v.display;menuHtml+="<span class='icon icon-arrow-right-2'></span>"
menuHtml+="</a>";menuHtml+="<ul class='sub-itens'>";angular.forEach(v.itens,function(v,k){if(v.itemParent){menuHtml+=readItensParent(v);}else{menuHtml+="<li>";menuHtml+="<a href='"+v.href+"' title='"+v.title+"' ng-class='{active:currentLink == \""+v.href+"\"}'>";menuHtml+=v.display;menuHtml+="</a>";menuHtml+="</li>";}});menuHtml+="</ul>";menuHtml+="</li>";return menuHtml;}});$app.directive('menuDropdown',function(){return{link:function(scope,element,attrs){element.on('click',function(){var subItem=element.parent().find('.sub-itens').first();var subItemAll=element.parent().find('.sub-itens');var icon=element.find('.icon');var iconAll=element.parent().find('.icon');if(subItem.hasClass('show')){subItem.removeClass('show');subItem.addClass('hide');icon.addClass('icon-arrow-left-2');icon.removeClass('icon-arrow-down');iconAll.removeClass('icon-arrow-down');iconAll.addClass('icon-arrow-left-2');subItemAll.hide("slide",{},200);subItem.hide("slide",{},200);}else{subItem.addClass('show');subItem.removeClass('hide');icon.removeClass('icon-arrow-left-2');icon.addClass('icon-arrow-down');subItem.show("slide",{},200);}});}}});$app.directive('menuToogle',function($timeout){return{scope:{type:"@menuToogle"},link:function(scope,element,attrs){element.on('click',function(){var contentMenu=$('.content-menu');var contentView=$('.content-view');var menu=$('.menu');if(element.hasClass('menu-show')){element.addClass('menu-hide');element.removeClass('menu-show');if(scope.type=="mobile"){contentMenu.hide('slide',{},150);}else{menu.hide('slideUp');$timeout(function(){contentMenu.animate({"width":"50px"},100);contentView.animate({"margin-left":"50px"},100);},200);}}else{element.removeClass('menu-hide');element.addClass('menu-show');if(scope.type=="mobile"){contentMenu.show('slide',{},150);}else{contentView.animate({"margin-left":"200px"},100);contentMenu.animate({"width":"200px"},100);$timeout(function(){menu.show('slideUp');},200);}}});}}});$app.directive("dropdownUser",function(){return{link:function(scope,element,attrs,model){var dropdown=element.find(".item");$(dropdown).on("click",execute);function execute(){var item=$(dropdown).parent().find("ul");var arrow=$(dropdown).find(".arrow");if($(item).hasClass("dropdown-show")){$(item).removeClass("dropdown-show").hide("explode");$(arrow).removeClass("icon-arrow-down-7");$(arrow).addClass("icon-arrow-right-8");}else{$(item).addClass("dropdown-show").show("fade");$(arrow).addClass("icon-arrow-down-7");$(arrow).removeClass("icon-arrow-right-8");}}}}});$app.directive('templateTopo',function(){return{restrict:"E",templateUrl:'/assets/js/admin/templates/layout/topo.html',link:function(scope,element,attrs,model){}}});$app.directive('templateMenu',function(){return{restrict:"E",templateUrl:'/assets/js/admin/templates/layout/menu.html',link:function(scope,element,attrs,model){}}});$app.directive('breadcrumbs',function($rootScope,MenuService,$compile){return{restrict:"E",link:function(scope,element,attrs,model){scope.breadcrumbs=[{nome:"HOME",link:"/admin"}];var menu=MenuService.getMenu();var link=$rootScope.currentLink;var array_link=link.split('/');array_link.splice(0,1);var breadcrumbs="<nav class='breadcrumbs'><ul>";if(array_link.length>1){breadcrumbs+=getItens(array_link,menu);}else{breadcrumbs+=getInicial();}
breadcrumbs+="</ul></nav>"
var el=angular.element(breadcrumbs);compiled=$compile(el)(scope);element.html(compiled);function getItens(array_link,menu){var breadcrumbs=getInicial();for(var i=1;i<array_link.length;i++){breadcrumbs+=getSeparator();var item=searchItem(array_link[i],menu);breadcrumbs+="<li>";breadcrumbs+="<a href='"+item.href+"' ng-class=\"{'active':currentLink == '"+item.href+"' }\">"+item.nome+"</a>";breadcrumbs+="</li>";}
return breadcrumbs;}
function searchItem(apelido,menu){var search=true;var item={nome:"",href:""};if(search==true){angular.forEach(menu,function(value,key){if(value.itemParent==true&&value.apelido==apelido){item.nome=value.display;item.href=value.href;search=false;}else if(value.itemParent==true&&value.apelido!=apelido){var i=searchItem(apelido,value.itens);if(i.nome.length>0){item.nome=i.nome;item.href=i.href;search=false;}}else if(value.apelido==apelido){item.nome=value.display;item.href=value.href;search=false;}});}
return item;}
function getSeparator(){var separator="<li><span class='separator'>/</span></li>";return separator;}
function getInicial(){var breadcrumbs="";breadcrumbs+="<li>";breadcrumbs+="<a href='/admin' ng-class=\"{'active':currentLink == '/admin' }\">HOME</a>";breadcrumbs+="</li>";return breadcrumbs;}}}});$app.directive('elfinder',function(CSRF_TOKEN){return{restrict:"E",link:function(scope,element,attrs,model){var data={};element.elfinder({toolbar:[['back','forward'],['reload'],['home','up'],['mkdir','mkfile','upload'],['open','download','getfile'],['info'],['quicklook'],['copy','cut','paste'],['rm'],['duplicate','rename','edit','resize'],['extract','archive'],['search'],['view'],['help']],url:'/admin/elfinder/connector?_token='+CSRF_TOKEN,lang:'pt_BR'}).elfinder('instance');}}});$app.directive('ckeditor',function(CSRF_TOKEN,$rootScope){return{require:'?ngModel',link:function($scope,element,attrs,ngModel){$rootScope.ckeditorStatus="<p class='ckeditor-status'>Carregando Editor<span class='icon-refresh'></span></p>";var ck=CKEDITOR.replace(element[0],{filebrowserBrowseUrl:"/admin/elfinder/show?_token="+CSRF_TOKEN,filebrowserImageBrowseUrl:"/admin/elfinder/show?_token="+CSRF_TOKEN,filebrowserFlashBrowseUrl:"/admin/elfinder/show?_token="+CSRF_TOKEN,filebrowserImageUploadUrl:"/admin/elfinder/show?_token="+CSRF_TOKEN,filebrowserFlashUploadUrl:"/admin/elfinder/show?_token="+CSRF_TOKEN,filebrowserImageWindowWidth:"980",filebrowserImageWindowHeight:"490",filebrowserWindowWidth:"980",filebrowserWindowHeight:"500"});ck.on('instanceReady',function(){$rootScope.$apply(function(){$rootScope.ckeditorStatus="";});});ck.on('pasteState',function(){$scope.$apply(function(){ngModel.$setViewValue(ck.getData());});});ngModel.$render=function(value){ck.setData(ngModel.$modelValue);};}};});$app.directive('publicaInGrid',function($resource,$compile,CSRF_TOKEN,$timeout){return{restrict:"AE",scope:{status:'=',url:'@',item:'=',permissao:'=',grid:'=',campo:"@"},link:function(scope,element,attrs,model){var html="";var status="";if(scope.status){status=false;html="<div class='publica-in-grid'><span class='icon-thumbs-up' ng-click='changePublicado()'></span></div>";}else{status=true;html="<div class='publica-in-grid'><span class='icon-thumbs-down' ng-click='changePublicado()'></span></div>";}
setView(html);scope.changePublicado=function(){if(scope.permissao){var request=$resource(scope.url,{_token:CSRF_TOKEN,campo:scope.campo},{update:{method:'PUT'}});element.find('.publica-in-grid').html('Processando...');var status=scope.status==true?false:true;if(scope.campo=='publicado'){scope.item.publicado=status;}else if(scope.campo=='destaque'){scope.item.destaque=status;}else{scope.item.capa=status;}
request.update(scope.item,function(response){if(response.status){var icon=status==true?'icon-thumbs-up':'icon-thumbs-down';var html="<div class='publica-in-grid'><span class='"+icon+"' ng-click='changePublicado()'></span></div>";if(scope.campo=='capa'){scope.grid.dataSource.read();}
setView(html);}else{element.find('.publica-in-grid').html('Erro ao alterar.');$timeout(function(){scope.grid.dataSource.read();},1000);}},function(response){element.find('.publica-in-grid').html('Erro ao Processar.');$timeout(function(){scope.grid.dataSource.read();},1000);});}else{alert("Sem permissão para alterar.");}}
function setView(html){var el=angular.element(html);var compile=$compile(el)(scope);element.html(compile);}}}});$app.directive('fileImagesService',function($resource,$rootScope,FileService,CSRF_TOKEN,$timeout){var templateHtml="";templateHtml+="<div class='row-fluid status-file-uploads-images btn-primary'><div class='body'></div></div><div class='content-file-images-service'>";templateHtml+="<div class='row-fluid'><div ng-repeat='i in images' class='item'><img src='{{path}}{{i.value}}' />";templateHtml+="<div class='row-fluid'><button type='button' class='btn btn-danger delete' ng-click='deleteFileService(path,i.value,$index)'><span class='icon icon-remove'></span></button></div>";templateHtml+="</div></div></div>";return{restrict:"E",scope:{path:"@path",images:"=images",combo_id:"@combo",refreshCombo:"@refreshCombo"},template:templateHtml,link:function(scope,element,attrs,modelCtrl){var status=element.find('.status-file-uploads-images');var options={refresh:scope.refreshCombo,combo_id:scope.combo_id};scope.deleteFileService=function(pasta,file,index){status.show('fade').find('.body').html('- Deletando arquivo.');var path=pasta+file;var resquest=$resource('/admin/files/delete',{_token:CSRF_TOKEN,path:path});resquest.delete(function(response){status.show('fade').find('.body').html(response.data);if(response.status==1){$rootScope.fileImagesService.splice($rootScope.fileImagesService.indexOf($rootScope.fileImagesService[index]),1);if(options.refresh=='true'){var combo=$(options.combo_id).data('kendoComboBox');combo.dataSource.read();$timeout(function(){status.hide('fade').find('.body').html('');},3000)}}},function(response){status.show('fade').find('.body').html('- Erro no servidor.');});}}}});$app.directive('modificaOrdem',function($resource,$rootScope,$compile){return{restrict:"E",scope:{route:"@route",params:"=params",campo:"@campo",path_imagem:"@pathImagem"},link:function(scope,element,attrs,modelCtrl){var template="";if(scope.campo=='imagem'){template="<div class='row-fluid status-ordem-modulo'></div><div class='content-ordem-modulo'><ul class='nav nav-ordem-modulo' sortable-ordem='itensSortable'><li ng-repeat='o in ordemItens' id='item_{{o.id}}'>{{$index+1}} - <img src='{{path_imagem}}{{o."+scope.campo+"}}' width='50px'/></li></ul></div>";}else{template="<div class='row-fluid status-ordem-modulo'></div><div class='content-ordem-modulo'><ul class='nav nav-ordem-modulo' sortable-ordem='itensSortable'><li ng-repeat='o in ordemItens' id='item_{{o.id}}'>{{$index+1}} - {{o."+scope.campo+"}}</li></ul></div>";}
var el=angular.element(template);var compile=$compile(el)(scope);element.html(compile);scope.$on('updateOrdemItens',function(event,data){updateOrdem(event,data)});var updateOrdem=function(event,data){var itens=data;var produtos=scope.ordemItens;var new_itens=[];angular.forEach(itens,function(v,k){var id=v.split('_');id=id[1];angular.forEach(produtos,function(v,k){if(v.id==id){new_itens.push(v);return false;}});});scope.ordemItens=new_itens;scope.$apply();}
function getOrdem(){var request=$resource(scope.route,scope.params);element.find(".status-ordem-modulo").addClass('btn-primary').html("<span>Carregando...</span>");request.query(function(response){scope.ordemItens=response;element.find(".status-ordem-modulo").addClass('btn-success').removeClass('btn-danger btn-primary').html("<span>"+response.length+" registros Carregados.</span>");},function(error){element.find(".status-ordem-modulo").addClass('btn-danger').removeClass('btn-success btn-primary').html("<span>Erro Carregar Registros.</span>");});}
getOrdem();}}});$app.directive('sortableOrdem',function($rootScope){return{restrict:'A',link:function(scope,element,attrs,model){element.sortable({cursor:'move',items:'li',update:function(){var data=element.sortable('toArray');$rootScope.itensOrdemSortable=element.sortable('toArray');scope.$emit('updateOrdemItens',data);$rootScope.$apply();}});element.disableSelection();}}});$app.directive('sortableOrdemFilters',function($rootScope){return{restrict:'A',link:function(scope,element,attrs,model){element.sortable({cursor:'move',items:'li',update:function(){var data=element.sortable('toArray');$rootScope.itensOrdemSortable=element.sortable('toArray');$rootScope.$apply();scope.$emit('updateOrdemProdutos',data);},start:function(){}});element.disableSelection();}}});$app.directive('modificaOrdemFilters',function($resource,$rootScope,$compile){return{restrict:"E",scope:{route:"@route",params:"=params",campo:"@campo",path_imagem:"@pathImagem"},link:function(scope,element,attrs,modelCtrl){scope.filterOrdem={titulo:''};var template="";if(scope.campo=='imagem'){template="<div class='row-fluid status-ordem-modulo'></div><div class='content-ordem-modulo'><ul class='nav nav-ordem-modulo' sortable-ordem='itensSortable'><li ng-repeat='o in ordemItens' id='item_{{o.id}}'>{{$index+1}} - <img src='{{path_imagem}}{{o."+scope.campo+"}}' width='50px'/></li></ul></div>";}else{template="<div class='row-fluid status-ordem-modulo'></div><div class='content-ordem-modulo'><form><input type='text' placeholder='Digite um Título' ng-model='filterOrdem.titulo' /></form><ul class='nav nav-ordem-modulo' sortable-ordem-filters='itensSortable'><li ng-repeat='o in ordemItens | filter:filterOrdem track by o.id' id='item_{{o.id}}' class='repeat-move' ng-mousedown='updateFilter()' >{{$index+1}} - {{o."+scope.campo+"}}</li></ul></div>";}
var el=angular.element(template);var compile=$compile(el)(scope);element.html(compile);scope.$on('updateOrdemProdutos',function(event,data){updateOrdem(event,data)});scope.$on('updateFilterProdutos',function(event){updateFilter()});scope.setFilter=function(){scope.filterOrdem={titulo:scope.titulo};scope.$apply();}
scope.updateFilter=function(){scope.filterOrdem={titulo:''};scope.$apply();}
var updateOrdem=function(event,data){var itens=data;var produtos=scope.ordemItens;var new_itens=[];angular.forEach(itens,function(v,k){var id=v.split('_');id=id[1];angular.forEach(produtos,function(v,k){if(v.id==id){new_itens.push(v);return false;}});});scope.ordemItens=new_itens;scope.$apply();}
function getOrdem(){var request=$resource(scope.route,scope.params);element.find(".status-ordem-modulo").addClass('btn-primary').html("<span>Carregando...</span>");request.query(function(response){scope.ordemItens=response;element.find(".status-ordem-modulo").addClass('btn-success').removeClass('btn-danger btn-primary').html("<span>"+response.length+" registros Carregados.</span>");},function(error){element.find(".status-ordem-modulo").addClass('btn-danger').removeClass('btn-success btn-primary').html("<span>Erro Carregar Registros.</span>");});}
getOrdem();}}});$app.directive('ngPaginaInicial',function($compile,$resource,CSRF_TOKEN){return{restrict:'A',scope:{dataItem:"=ngPaginaInicial"},link:function(scope,element,attrs,model){var html="";var request=$resource('/admin/menu-itens/updatePaginaInicial',{_token:CSRF_TOKEN,id:scope.dataItem.id},{update:{method:'PUT'}});if(scope.dataItem.pagina_inicial){html="<span class='icon-home-2' style='font-size:20px;'></span>";}else{html="<span ng-click='updatePaginaInicial()' class='icon-blocked' style='font-size:20px;cursor:pointer;'></span>";}
var el=angular.element(html);var compile=$compile(el)(scope);element.html(compile);scope.updatePaginaInicial=function(){element.html('Processando..');request.update(function(response){if(response.status==1){var grid=$('#menuItensGrid').data('kendoGrid');grid.dataSource.read();}else{alert(response.data);}},function(response){alert('error');});}}}});